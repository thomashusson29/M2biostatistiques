<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>S1_CUSM_RÉSUMÉ_STATISTIQUE</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="S1_3_Tests_statistiques_et_IC_files/libs/clipboard/clipboard.min.js"></script>
<script src="S1_3_Tests_statistiques_et_IC_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="S1_3_Tests_statistiques_et_IC_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="S1_3_Tests_statistiques_et_IC_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="S1_3_Tests_statistiques_et_IC_files/libs/quarto-html/popper.min.js"></script>
<script src="S1_3_Tests_statistiques_et_IC_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="S1_3_Tests_statistiques_et_IC_files/libs/quarto-html/anchor.min.js"></script>
<link href="S1_3_Tests_statistiques_et_IC_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="S1_3_Tests_statistiques_et_IC_files/libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="S1_3_Tests_statistiques_et_IC_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="S1_3_Tests_statistiques_et_IC_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="S1_3_Tests_statistiques_et_IC_files/libs/bootstrap/bootstrap-d6a003b94517c951b2d65075d42fb01b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="S1_3_Tests_statistiques_et_IC_files/libs/kePrint-0.0.1/kePrint.js"></script>
<link href="S1_3_Tests_statistiques_et_IC_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction-en-pratique-comment-utiliser-les-tests-statistiques" id="toc-introduction-en-pratique-comment-utiliser-les-tests-statistiques" class="nav-link active" data-scroll-target="#introduction-en-pratique-comment-utiliser-les-tests-statistiques"><span class="header-section-number">1</span> Introduction : en pratique, comment utiliser les tests statistiques ?</a>
  <ul>
  <li><a href="#à-quoi-servent-vraiment-les-tests-statistiques" id="toc-à-quoi-servent-vraiment-les-tests-statistiques" class="nav-link" data-scroll-target="#à-quoi-servent-vraiment-les-tests-statistiques"><span class="header-section-number">1.1</span> À quoi servent vraiment les tests statistiques ?</a></li>
  <li><a href="#quand-lusage-est-légitime" id="toc-quand-lusage-est-légitime" class="nav-link" data-scroll-target="#quand-lusage-est-légitime"><span class="header-section-number">1.2</span> Quand l’usage est légitime</a></li>
  <li><a href="#mésusages-fréquents-et-pourquoi-ils-posent-problème" id="toc-mésusages-fréquents-et-pourquoi-ils-posent-problème" class="nav-link" data-scroll-target="#mésusages-fréquents-et-pourquoi-ils-posent-problème"><span class="header-section-number">1.3</span> Mésusages fréquents (et pourquoi ils posent problème)</a></li>
  <li><a href="#fil-conducteur-à-retenir" id="toc-fil-conducteur-à-retenir" class="nav-link" data-scroll-target="#fil-conducteur-à-retenir"><span class="header-section-number">1.4</span> Fil conducteur à retenir</a></li>
  </ul></li>
  <li><a href="#quels-tests-pour-quelles-hypohèses" id="toc-quels-tests-pour-quelles-hypohèses" class="nav-link" data-scroll-target="#quels-tests-pour-quelles-hypohèses"><span class="header-section-number">2</span> Quels tests pour quelles hypohèses ?</a>
  <ul>
  <li><a href="#comparaison-de-2-pourcentages" id="toc-comparaison-de-2-pourcentages" class="nav-link" data-scroll-target="#comparaison-de-2-pourcentages"><span class="header-section-number">2.1</span> Comparaison de 2 pourcentages</a>
  <ul>
  <li><a href="#test-du-chi2-de-pearson" id="toc-test-du-chi2-de-pearson" class="nav-link" data-scroll-target="#test-du-chi2-de-pearson"><span class="header-section-number">2.1.1</span> Test du chi2 de Pearson</a>
  <ul class="collapse">
  <li><a href="#chi2-r" id="toc-chi2-r" class="nav-link" data-scroll-target="#chi2-r"><span class="header-section-number">2.1.1.1</span> Chi2 R</a></li>
  </ul></li>
  <li><a href="#test-exact-de-fisher" id="toc-test-exact-de-fisher" class="nav-link" data-scroll-target="#test-exact-de-fisher"><span class="header-section-number">2.1.2</span> Test exact de Fisher</a>
  <ul class="collapse">
  <li><a href="#fisher-r" id="toc-fisher-r" class="nav-link" data-scroll-target="#fisher-r"><span class="header-section-number">2.1.2.1</span> Fisher R</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#comparaison-dun-pourcentage-a-un-pourcentage-théorique" id="toc-comparaison-dun-pourcentage-a-un-pourcentage-théorique" class="nav-link" data-scroll-target="#comparaison-dun-pourcentage-a-un-pourcentage-théorique"><span class="header-section-number">2.2</span> Comparaison d’un pourcentage a un pourcentage théorique</a></li>
  <li><a href="#comparaison-de-3-pourcentages" id="toc-comparaison-de-3-pourcentages" class="nav-link" data-scroll-target="#comparaison-de-3-pourcentages"><span class="header-section-number">2.3</span> Comparaison de 3 pourcentages</a></li>
  <li><a href="#comparaison-de-2-moyennes" id="toc-comparaison-de-2-moyennes" class="nav-link" data-scroll-target="#comparaison-de-2-moyennes"><span class="header-section-number">2.4</span> Comparaison de 2 moyennes</a>
  <ul>
  <li><a href="#comparaison-de-2-moyennes-avec-r" id="toc-comparaison-de-2-moyennes-avec-r" class="nav-link" data-scroll-target="#comparaison-de-2-moyennes-avec-r"><span class="header-section-number">2.4.0.1</span> Comparaison de 2 moyennes avec R</a></li>
  </ul></li>
  <li><a href="#comparaison-de-3-moyennes-ou-plus" id="toc-comparaison-de-3-moyennes-ou-plus" class="nav-link" data-scroll-target="#comparaison-de-3-moyennes-ou-plus"><span class="header-section-number">2.5</span> Comparaison de 3 moyennes ou plus</a>
  <ul>
  <li><a href="#exemple-r" id="toc-exemple-r" class="nav-link" data-scroll-target="#exemple-r"><span class="header-section-number">2.5.1</span> Exemple R</a></li>
  </ul></li>
  <li><a href="#test-de-nullité-dun-coefficient-de-corrélation" id="toc-test-de-nullité-dun-coefficient-de-corrélation" class="nav-link" data-scroll-target="#test-de-nullité-dun-coefficient-de-corrélation"><span class="header-section-number">2.6</span> Test de nullité d’un coefficient de corrélation</a>
  <ul>
  <li><a href="#test-de-nullité-du-coefficient-de-corrélation-avec-r" id="toc-test-de-nullité-du-coefficient-de-corrélation-avec-r" class="nav-link" data-scroll-target="#test-de-nullité-du-coefficient-de-corrélation-avec-r"><span class="header-section-number">2.6.1</span> Test de nullité du coefficient de corrélation avec R</a></li>
  </ul></li>
  <li><a href="#tests-appariés-non-appariés" id="toc-tests-appariés-non-appariés" class="nav-link" data-scroll-target="#tests-appariés-non-appariés"><span class="header-section-number">2.7</span> Tests appariés / non appariés</a>
  <ul>
  <li><a href="#exemple-r-données-appariées" id="toc-exemple-r-données-appariées" class="nav-link" data-scroll-target="#exemple-r-données-appariées"><span class="header-section-number">2.7.1</span> Exemple R données appariées</a>
  <ul class="collapse">
  <li><a href="#exemple-1" id="toc-exemple-1" class="nav-link" data-scroll-target="#exemple-1"><span class="header-section-number">2.7.1.1</span> Exemple 1</a></li>
  <li><a href="#exemple-2" id="toc-exemple-2" class="nav-link" data-scroll-target="#exemple-2"><span class="header-section-number">2.7.1.2</span> Exemple 2</a></li>
  <li><a href="#tbl_summary-apparié" id="toc-tbl_summary-apparié" class="nav-link" data-scroll-target="#tbl_summary-apparié"><span class="header-section-number">2.7.1.3</span> tbl_summary apparié</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
  <li><a href="#calcul-de-beta-et-du-nombre-de-sujets-à-inclure" id="toc-calcul-de-beta-et-du-nombre-de-sujets-à-inclure" class="nav-link" data-scroll-target="#calcul-de-beta-et-du-nombre-de-sujets-à-inclure"><span class="header-section-number">3</span> Calcul de <span class="math inline">\(\beta\)</span> et du nombre de sujets à inclure</a>
  <ul>
  <li><a href="#exemple-r-1" id="toc-exemple-r-1" class="nav-link" data-scroll-target="#exemple-r-1"><span class="header-section-number">3.1</span> Exemple R</a></li>
  </ul></li>
  <li><a href="#tests-uni--ou-bilatéraux" id="toc-tests-uni--ou-bilatéraux" class="nav-link" data-scroll-target="#tests-uni--ou-bilatéraux"><span class="header-section-number">4</span> Tests uni- ou bilatéraux ?</a>
  <ul>
  <li><a href="#définitions" id="toc-définitions" class="nav-link" data-scroll-target="#définitions"><span class="header-section-number">4.1</span> Définitions</a></li>
  <li><a href="#exemple" id="toc-exemple" class="nav-link" data-scroll-target="#exemple"><span class="header-section-number">4.2</span> Exemple</a></li>
  </ul></li>
  <li><a href="#intervalles-de-confiance" id="toc-intervalles-de-confiance" class="nav-link" data-scroll-target="#intervalles-de-confiance"><span class="header-section-number">5</span> Intervalles de confiance</a>
  <ul>
  <li><a href="#définitions-1" id="toc-définitions-1" class="nav-link" data-scroll-target="#définitions-1"><span class="header-section-number">5.1</span> Définitions</a></li>
  <li><a href="#exemple-r-2" id="toc-exemple-r-2" class="nav-link" data-scroll-target="#exemple-r-2"><span class="header-section-number">5.2</span> Exemple R</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="S1_3_Tests_statistiques_et_IC.docx"><i class="bi bi-file-word"></i>MS Word</a></li><li><a href="https://github.com/thomashusson29/M2biostatistiques/blob/main/Cours/S1_3_Tests_statistiques_et_IC.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">S1_CUSM_RÉSUMÉ_STATISTIQUE</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div style="page-break-after: always;"></div>
<section id="introduction-en-pratique-comment-utiliser-les-tests-statistiques" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction : en pratique, comment utiliser les tests statistiques ?</h1>
<section id="à-quoi-servent-vraiment-les-tests-statistiques" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="à-quoi-servent-vraiment-les-tests-statistiques"><span class="header-section-number">1.1</span> À quoi servent vraiment les tests statistiques ?</h2>
<p>Les tests statistiques ont deux fonctions simultanées :</p>
<ul>
<li><strong>Outils d’inférence</strong></li>
</ul>
<p>Ils permettent de passer de ce qui est observé sur un échantillon à une affirmation sur une population plus large (effet d’un traitement, différence entre groupes, association entre variables).</p>
<ul>
<li><strong>Langage commun de la communauté scientifique</strong></li>
</ul>
<p>Ils fournissent un cadre standardisé (H0/H1, p-value, intervalles de confiance, seuils “significatifs”) qui permet de présenter des résultats de manière compréhensible et acceptable dans les revues.</p>
<p>Mais ce sont des outils inductifs, pas des démonstrations logiques :</p>
<ul>
<li><p>Rejeter ou “accepter” H0/H1 ne prouve jamais qu’une hypothèse est vraie.</p></li>
<li><p>La p-value exprime à quel point les données sont compatibles avec H0, pas la probabilité que H0 soit vraie ou fausse.</p></li>
<li><p>La crédibilité scientifique d’un résultat dépend aussi de la théorie, de la littérature, du plan d’étude, et du bon sens clinique.</p></li>
</ul>
</section>
<section id="quand-lusage-est-légitime" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="quand-lusage-est-légitime"><span class="header-section-number">1.2</span> Quand l’usage est légitime</h2>
<p>Un test statistique est pertinent quand il répond à une question scientifique centrale, formulée à l’avance :</p>
<ul>
<li><p>Comparer un critère principal entre deux traitements dans un essai randomisé.</p></li>
<li><p>Tester l’association entre une exposition majeure (tabac, intervention chirurgicale) et un outcome clinique important (mortalité, complication grave).</p></li>
<li><p>Évaluer un effet que le chercheur est capable d’interpréter en termes cliniques ou de santé publique.</p></li>
</ul>
<p>Dans ces situations :</p>
<ul>
<li><p>L’hypothèse nulle H0 et l’hypothèse alternative H1 sont définies clairement.</p></li>
<li><p>Le test vient au service d’une question, et non l’inverse.</p></li>
</ul>
</section>
<section id="mésusages-fréquents-et-pourquoi-ils-posent-problème" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="mésusages-fréquents-et-pourquoi-ils-posent-problème"><span class="header-section-number">1.3</span> Mésusages fréquents (et pourquoi ils posent problème)</h2>
<p>C’est surtout l’usage disproportionné des tests qui crée les dérives : on teste tout, partout, pour justifier des phrases qui n’ont pas besoin de test.</p>
<ol type="1">
<li><p>Test de normalité de Shapiro-Wilk</p>
<ul>
<li><p>H0 : la variable suit une loi normale dans la population.</p></li>
<li><p>Si p &gt; 0,05, la tentation est de conclure : « La variable est normale, donc on peut utiliser des tests paramétriques. »</p></li>
<li><p>Problèmes :</p>
<ul>
<li><p>Avec un petit effectif, le test a peu de puissance : il ne rejette H0 que si la distribution est très clairement non normale.</p></li>
<li><p>Interpréter p &gt; 0,05 comme “preuve de normalité” est faux : cela signifie juste qu’on n’a pas détecté d’écart flagrant avec la normale.</p></li>
<li><p>Avec un très gros effectif, le test peut donner p &lt; 0,05 pour des écarts minimes, sans impact pratique.</p></li>
</ul></li>
<li><p>Conclusion raisonnable :</p>
<ul>
<li><p>p &gt; 0,05 → “aucune incompatibilité majeure détectée avec la normalité, compte tenu de la taille de l’échantillon”.</p></li>
<li><p>Cela ne dispense pas de regarder un histogramme, un QQ-plot, et d’évaluer si un modèle gaussien est sensé dans le contexte.</p></li>
</ul></li>
</ul></li>
</ol>
<p>Dire “Shapiro est non significatif, donc la variable est normale” est un mésusage.</p>
<ol start="2" type="1">
<li><p>Tester les caractéristiques des perdus de vue</p>
<ul>
<li><p>Usage fréquent :</p>
<ul>
<li><p>Comparer les patients perdus de vue à ceux qui restent dans l’étude (âge, sexe, gravité, etc.).</p></li>
<li><p>Si p &gt; 0,05 partout → “les perdus de vue ne sont pas différents, donc ils ne posent pas de problème”.</p></li>
</ul></li>
<li><p>Problèmes :</p>
<ul>
<li>Là encore, p &gt; 0,05 n’est pas une preuve d’égalité :</li>
<li>avec peu de perdus de vue, les tests manquent de puissance ;</li>
<li>des différences cliniquement importantes peuvent passer sous le radar.</li>
<li>Le mécanisme de perte de vue est souvent non testable (motifs non observés, biais de sélection).</li>
</ul></li>
<li><p>Conclusion raisonnable :</p>
<ul>
<li>Ces tests peuvent donner un indice (pas de différence massive détectée),</li>
<li>mais ne suffisent pas à conclure que les perdus de vue sont “neutres” pour l’analyse.</li>
</ul></li>
</ul></li>
<li><p>Batteries massives de tests exploratoires</p>
<ul>
<li><p>Tester toutes les variables de base entre les bras d’un essai randomisé (alors que la randomisation rend ces tests conceptuellement inutiles).</p></li>
<li><p>Tester tous les sous-groupes, toutes les interactions, toutes les variables disponibles “pour voir ce qui sort”.</p></li>
<li><p>Retenir ensuite les résultats avec p &lt; 0,05 comme s’il s’agissait de preuves robustes.</p></li>
<li><p>Problèmes :</p>
<ul>
<li><p>Inflation du risque d’erreur de type I : plus il y a de tests, plus on obtient de “significatifs” par hasard.</p></li>
<li><p>Risque élevé de p-hacking : on sélectionne après coup ce qui donne un beau p.</p></li>
</ul></li>
</ul></li>
</ol>
</section>
<section id="fil-conducteur-à-retenir" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="fil-conducteur-à-retenir"><span class="header-section-number">1.4</span> Fil conducteur à retenir</h2>
<ul>
<li><p>Un test statistique doit être utilisé :</p>
<ul>
<li><p>pour éclairer une question scientifique précise,</p></li>
<li><p>avec une hypothèse claire et une interprétation clinique possible.</p></li>
</ul></li>
<li><p>Il ne doit pas servir :</p>
<ul>
<li><p>à “prouver” que quelque chose est vrai ou normal (ex : Shapiro-Wilk),</p></li>
<li><p>à valider a posteriori des affirmations faibles ou secondaires,</p></li>
<li><p>ni à compenser l’absence de réflexion sur le plan d’étude.</p></li>
</ul></li>
</ul>
<p>Les tests sont un outil chiffré parmi d’autres au service du raisonnement scientifique, pas un substitut au raisonnement.</p>
</section>
</section>
<section id="quels-tests-pour-quelles-hypohèses" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Quels tests pour quelles hypohèses ?</h1>
<section id="comparaison-de-2-pourcentages" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="comparaison-de-2-pourcentages"><span class="header-section-number">2.1</span> Comparaison de 2 pourcentages</h2>
<section id="test-du-chi2-de-pearson" class="level3" data-number="2.1.1">
<h3 data-number="2.1.1" class="anchored" data-anchor-id="test-du-chi2-de-pearson"><span class="header-section-number">2.1.1</span> Test du chi2 de Pearson</h3>
<p>Le test du chi2 de Pearson compare la <strong>répartition</strong> de deux variables qualitatives (ex : présence/absence d’un événement dans deux groupes).</p>
<p>En fait : il <strong>teste l’indépendance</strong> entre deux variables qualitatives dans un tableau de contingence.</p>
<p><span class="math inline">\(\chi^2 = \sum \frac{(O - E)^2}{E}\)</span></p>
<p>Plus le <span class="math inline">\(\chi^2\)</span> est grand, plus les observations (O) s’éloignent des effectifs attendus sous H0 (E).</p>
<p>Conditions de validité :</p>
<ul>
<li><p>Effectifs théoriques ≥ 5 dans chaque case du tableau de contingence.</p></li>
<li><p>Indépendance des observations = pas de mesures répétées, pas de données appariées.</p></li>
<li><p>Distribution appromiximativement chi2 sous H0 (c’est à dire une somme de carrés de lois normales centrées réduites).</p></li>
<li><p>Approximation de la loi binomiale par la loi normale</p></li>
</ul>
<section id="chi2-r" class="level4" data-number="2.1.1.1">
<h4 data-number="2.1.1.1" class="anchored" data-anchor-id="chi2-r"><span class="header-section-number">2.1.1.1</span> Chi2 R</h4>
<p>dans l’étude smp : on teste l’hypothèse que le niveau de dépression est fonction de l’âge, avec âge binarisé pour &gt; ou &lt; 50 ans</p>
<p>Il est nécessaire de désactiver la correction de continuité de Yates (par défaut dans R) pour un test du chi2 classique</p>
<p>La correction du chi2 de Yates est une correction appliquée pour réduire le biais dans l’estimation du chi2 lorsque les effectifs sont petits.</p>
<p>Cependant, elle peut être trop conservatrice et diminuer la puissance du test.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>smp<span class="sc">$</span>agebin <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(smp<span class="sc">$</span>age<span class="sc">&gt;</span><span class="dv">50</span>, <span class="st">"&gt;50"</span>, <span class="st">"&lt;=50"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>table_depression_age <span class="ot">&lt;-</span> <span class="fu">table</span>(smp<span class="sc">$</span>depression, smp<span class="sc">$</span>agebin)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(table_depression_age, <span class="at">correct=</span><span class="cn">FALSE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's Chi-squared test

data:  table_depression_age
X-squared = 6.0611, df = 1, p-value = 0.01382</code></pre>
</div>
</div>
<p>L’avntage de cette approche est qu’elle est très simple à mettre en œuvre et à interpréter, et surtout elle affiche un message d’erreur si les conditions de validité ne sont pas remplies.</p>
<p>Avec <code>tbl_summary</code> du package <code>gtsummary</code> :</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># | message : false</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># | warning: false</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>tableau <span class="ot">&lt;-</span> smp <span class="sc">%&gt;%</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tbl_summary</span>(</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">by =</span> agebin,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">include =</span> depression,</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">statistic =</span> <span class="fu">all_categorical</span>() <span class="sc">~</span> <span class="st">"{n} / {N} ({p}%)"</span>,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">percent =</span> <span class="st">"column"</span>,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">missing =</span> <span class="st">"no"</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_p</span>(</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">test =</span> <span class="fu">all_categorical</span>() <span class="sc">~</span> <span class="st">"chisq.test"</span>,</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">test.args =</span> <span class="fu">all_categorical</span>() <span class="sc">~</span> <span class="fu">list</span>(<span class="at">correct =</span> <span class="cn">FALSE</span>)   <span class="co"># sans correction de continuité</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>2 missing rows in the "agebin" column have been removed.</code></pre>
</div>
</div>
<table class="table caption-top">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Characteristic</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">&lt;=50<br>
N = 646</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">&gt;50<br>
N = 151</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">p-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left; width: 6cm;">depression</td>
<td style="text-align: center;">267 / 646 (41%)</td>
<td style="text-align: center;">46 / 151 (30%)</td>
<td style="text-align: center;">0.014</td>
</tr>
</tbody><tfoot>
<tr class="odd">
<td style="text-align: left; padding: 0;"><sup>1</sup> n / N (%)</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0;"><sup>2</sup> Pearson's Chi-squared test</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
</tfoot>

</table>
<p>Avec la fonction <code>CrossTable</code> du package <code>gmodels</code> (mais qui est un peu verbeuse) mais qui donne les résultats complets avec et sans correction de Yates :</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">CrossTable</span>(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    smp<span class="sc">$</span>depression, smp<span class="sc">$</span>agebin, </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">fisher=</span><span class="cn">TRUE</span>, </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">chisq=</span><span class="cn">TRUE</span>, </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">expected=</span><span class="cn">TRUE</span>, </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">sresid=</span><span class="cn">TRUE</span>, </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">format=</span><span class="st">"SPSS"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
   Cell Contents
|-------------------------|
|                   Count |
|         Expected Values |
| Chi-square contribution |
|             Row Percent |
|          Column Percent |
|           Total Percent |
|            Std Residual |
|-------------------------|

Total Observations in Table:  797 

               | smp$agebin 
smp$depression |     &lt;=50  |      &gt;50  | Row Total | 
---------------|-----------|-----------|-----------|
             0 |      379  |      105  |      484  | 
               |  392.301  |   91.699  |           | 
               |    0.451  |    1.929  |           | 
               |   78.306% |   21.694% |   60.728% | 
               |   58.669% |   69.536% |           | 
               |   47.553% |   13.174% |           | 
               |   -0.672  |    1.389  |           | 
---------------|-----------|-----------|-----------|
             1 |      267  |       46  |      313  | 
               |  253.699  |   59.301  |           | 
               |    0.697  |    2.983  |           | 
               |   85.304% |   14.696% |   39.272% | 
               |   41.331% |   30.464% |           | 
               |   33.501% |    5.772% |           | 
               |    0.835  |   -1.727  |           | 
---------------|-----------|-----------|-----------|
  Column Total |      646  |      151  |      797  | 
               |   81.054% |   18.946% |           | 
---------------|-----------|-----------|-----------|

 
Statistics for All Table Factors


Pearson's Chi-squared test 
------------------------------------------------------------
Chi^2 =  6.061119     d.f. =  1     p =  0.01381901 

Pearson's Chi-squared test with Yates' continuity correction 
------------------------------------------------------------
Chi^2 =  5.613999     d.f. =  1     p =  0.01781755 

 
Fisher's Exact Test for Count Data
------------------------------------------------------------
Sample estimate odds ratio:  0.6222266 

Alternative hypothesis: true odds ratio is not equal to 1
p =  0.0159447 
95% confidence interval:  0.4152049 0.9219831 

Alternative hypothesis: true odds ratio is less than 1
p =  0.008343204 
95% confidence interval:  0 0.8689116 

Alternative hypothesis: true odds ratio is greater than 1
p =  0.995116 
95% confidence interval:  0.4423434 Inf 


 
       Minimum expected frequency: 59.30113 </code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
<p>En calculant le test “OR = 1” avec la fonction <code>epi.2by2</code> du package <code>epiR</code> :</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(epiR)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">epi.2by2</span>(table_depression_age, <span class="at">method=</span><span class="st">"cohort.count"</span>, <span class="at">conf.level=</span><span class="fl">0.95</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>             Outcome+    Outcome-      Total                 Inc risk *
Exposure+         379         105        484     78.31 (74.36 to 81.90)
Exposure-         267          46        313     85.30 (80.89 to 89.04)
Total             646         151        797     81.05 (78.16 to 83.72)

Point estimates and 95% CIs:
-------------------------------------------------------------------
Inc risk ratio                                 0.92 (0.86, 0.98)
Inc odds ratio                                 0.62 (0.43, 0.91)
Attrib risk in the exposed *                   -7.00 (-12.37, -1.62)
Attrib fraction in the exposed (%)            -8.94 (-16.30, -1.83)
Attrib risk in the population *                -4.25 (-9.02, 0.52)
Attrib fraction in the population (%)         -5.24 (-6.35, -3.49)
-------------------------------------------------------------------
Uncorrected chi2 test that OR = 1: chi2(1) = 6.061 Pr&gt;chi2 = 0.014
Fisher exact test that OR = 1: Pr&gt;chi2 = 0.016
 Wald confidence limits
 CI: confidence interval
 * Outcomes per 100 population units </code></pre>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Le test du chi2 teste l’hypothèse d’indépendance entre deux variables qualitatives.</p>
<p>Ca revient exactement au même de tester l’hypothèse que l’OR = 1 dans un tableau de contingence 2x2.</p>
<p>Donc la p-value du chi2 et celle du test “OR = 1” sont identiques.</p>
</div>
</div>
</section>
</section>
<section id="test-exact-de-fisher" class="level3" data-number="2.1.2">
<h3 data-number="2.1.2" class="anchored" data-anchor-id="test-exact-de-fisher"><span class="header-section-number">2.1.2</span> Test exact de Fisher</h3>
<p>Le test exact de Fisher compare la <strong>répartition</strong> de deux variables qualitatives dans des petits échantillons (ex : présence/absence d’un événement dans deux groupes).</p>
<p>Conditions de validité :</p>
<ul>
<li><p>Effectifs théoriques &lt; 5 dans au moins une case du tableau de contingence.</p></li>
<li><p>Indépendance des observations = pas de mesures répétées, pas de données appariées.</p></li>
</ul>
<section id="fisher-r" class="level4" data-number="2.1.2.1">
<h4 data-number="2.1.2.1" class="anchored" data-anchor-id="fisher-r"><span class="header-section-number">2.1.2.1</span> Fisher R</h4>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fisher.test</span>(smp<span class="sc">$</span>age<span class="sc">&gt;</span><span class="dv">75</span>, smp<span class="sc">$</span>depression)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Fisher's Exact Test for Count Data

data:  smp$age &gt; 75 and smp$depression
p-value = 0.7104
alternative hypothesis: true odds ratio is not equal to 1
95 percent confidence interval:
 0.05833312 3.79332074
sample estimates:
odds ratio 
 0.6164281 </code></pre>
</div>
</div>
<p>La p value du test vaut 0,71.</p>
<p>On aurait pu aussi faire ça avec d’autres foncions :</p>
<p>Avec <code>tbl_summary</code> du package <code>gtsummary</code> :</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>smp<span class="sc">$</span>age75 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(smp<span class="sc">$</span>age<span class="sc">&gt;</span><span class="dv">75</span>, <span class="st">"&gt;75"</span>, <span class="st">"&lt;=75"</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>tableau_fisher <span class="ot">&lt;-</span> smp <span class="sc">%&gt;%</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tbl_summary</span>(</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">by =</span> age75,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">include =</span> depression,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">statistic =</span> <span class="fu">all_categorical</span>() <span class="sc">~</span> <span class="st">"{n} / {N} ({p}%)"</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">percent =</span> <span class="st">"column"</span>,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">missing =</span> <span class="st">"no"</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_p</span>(</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">test =</span> <span class="fu">all_categorical</span>() <span class="sc">~</span> <span class="st">"fisher.test"</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>2 missing rows in the "age75" column have been removed.</code></pre>
</div>
</div>
<table class="table caption-top">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Characteristic</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">&lt;=75<br>
N = 790</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">&gt;75<br>
N = 7</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">p-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left; width: 6cm;">depression</td>
<td style="text-align: center;">311 / 790 (39%)</td>
<td style="text-align: center;">2 / 7 (29%)</td>
<td style="text-align: center;">0.7</td>
</tr>
</tbody><tfoot>
<tr class="odd">
<td style="text-align: left; padding: 0;"><sup>1</sup> n / N (%)</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0;"><sup>2</sup> Fisher's exact test</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
</tfoot>

</table>
<div style="page-break-after: always;"></div>
</section>
</section>
</section>
<section id="comparaison-dun-pourcentage-a-un-pourcentage-théorique" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="comparaison-dun-pourcentage-a-un-pourcentage-théorique"><span class="header-section-number">2.2</span> Comparaison d’un pourcentage a un pourcentage théorique</h2>
<p>Situation peu fréquente !</p>
<p>Par exemple : équiprobabilité de naissance entre garçons et filles (50%)</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">binom.test</span>(<span class="dv">538</span>, <span class="dv">1000</span>, <span class="at">p =</span> <span class="fl">0.5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Exact binomial test

data:  538 and 1000
number of successes = 538, number of trials = 1000, p-value = 0.01766
alternative hypothesis: true probability of success is not equal to 0.5
95 percent confidence interval:
 0.5065264 0.5692493
sample estimates:
probability of success 
                 0.538 </code></pre>
</div>
</div>
<p>p-value = 0.01766 : on rejette l’hypothèse d’équiprobabilité.</p>
</section>
<section id="comparaison-de-3-pourcentages" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="comparaison-de-3-pourcentages"><span class="header-section-number">2.3</span> Comparaison de 3 pourcentages</h2>
<p>Peu fréquente non plus !</p>
<p>utiliser aussi le test du chi2 de Pearson</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>smp<span class="sc">$</span>age.t <span class="ot">&lt;-</span> <span class="fu">cut</span>(smp<span class="sc">$</span>age, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>, <span class="dv">25</span>, <span class="dv">50</span>, <span class="cn">Inf</span>))</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>tb <span class="ot">&lt;-</span> <span class="fu">table</span>(smp<span class="sc">$</span>age.t, smp<span class="sc">$</span>depression, <span class="at">deparse.level=</span><span class="dv">2</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(tb, <span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>           smp$depression
smp$age.t           0         1
  (-Inf,25] 0.5357143 0.4642857
  (25,50]   0.6007905 0.3992095
  (50, Inf] 0.6953642 0.3046358</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(tb, <span class="at">correct=</span><span class="cn">FALSE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's Chi-squared test

data:  tb
X-squared = 8.0084, df = 2, p-value = 0.01824</code></pre>
</div>
</div>
<p>Et encore avec <code>tbl_summary</code> du package <code>gtsummary</code> :</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>tableau_age3 <span class="ot">&lt;-</span> smp <span class="sc">%&gt;%</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tbl_summary</span>(</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">by =</span> age.t,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">include =</span> depression,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">statistic =</span> <span class="fu">all_categorical</span>() <span class="sc">~</span> <span class="st">"{n} / {N} ({p}%)"</span>,</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">percent =</span> <span class="st">"column"</span>,</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">missing =</span> <span class="st">"no"</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_p</span>(</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">test =</span> <span class="fu">all_categorical</span>() <span class="sc">~</span> <span class="st">"chisq.test"</span>,</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">test.args =</span> <span class="fu">all_categorical</span>() <span class="sc">~</span> <span class="fu">list</span>(<span class="at">correct =</span> <span class="cn">FALSE</span>)   <span class="co"># sans correction de continuité</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>2 missing rows in the "age.t" column have been removed.</code></pre>
</div>
</div>
<table class="table caption-top">
<colgroup>
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Characteristic</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">(-Inf,25]<br>
N = 140</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">(25,50]<br>
N = 506</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">(50, Inf]<br>
N = 151</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">p-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left; width: 6cm;">depression</td>
<td style="text-align: center;">65 / 140 (46%)</td>
<td style="text-align: center;">202 / 506 (40%)</td>
<td style="text-align: center;">46 / 151 (30%)</td>
<td style="text-align: center;">0.018</td>
</tr>
</tbody><tfoot>
<tr class="odd">
<td style="text-align: left; padding: 0;"><sup>1</sup> n / N (%)</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0;"><sup>2</sup> Pearson's Chi-squared test</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
</tfoot>

</table>
<p>Le problème pour interpréter cette p-value :</p>
<ul>
<li><p>On sait qu’il y a une différence entre au moins deux groupes d’âge, mais on ne sait pas lesquels.</p></li>
<li><p>On sait en gros que l’hypothèse <span class="math inline">\(p_1 = p_2 = p_3\)</span> est fausse, mais on ne sait pas quelles sont les paires pour lesquelles <span class="math inline">\(p_i \ne p_j\)</span>.</p></li>
</ul>
<p>Dans cette situation : il faut utiliser un test Chi2 de tendance :</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>num <span class="ot">&lt;-</span> tb[ ,<span class="dv">2</span>]</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>den <span class="ot">&lt;-</span> tb[ ,<span class="dv">1</span>] <span class="sc">+</span> tb[ ,<span class="dv">2</span>] <span class="co"># on aurait pu faire rowSums(tb)</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.trend.test</span>(num, den)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Chi-squared Test for Trend in Proportions

data:  num out of den ,
 using scores: 1 2 3
X-squared = 7.84, df = 1, p-value = 0.00511</code></pre>
</div>
</div>
<p>La p value est &lt; 0,05 : on rejette l’hypothèse d’égalité des proportions en fonction de l’âge.</p>
<p>Il y a donc une tendance significative de la proportion de dépression en fonction de l’âge.</p>
<p>On peut aussi faire ça avec le package <code>gtsummary</code> mais il faut définir une fonction de test personnalisée ce qui n’est pas dingo quand même !</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>trend_test <span class="ot">&lt;-</span> <span class="cf">function</span>(data, variable, by, ...) {</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    tab <span class="ot">&lt;-</span> <span class="fu">table</span>(data[[by]], data[[variable]])  <span class="co"># lignes = âge, colonnes = depression</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># on teste la tendance des proportions de "depression = 1" selon l'âge</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <span class="fu">prop.trend.test</span>(<span class="at">x =</span> tab[, <span class="st">"1"</span>], <span class="at">n =</span> <span class="fu">rowSums</span>(tab))</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">p.value =</span> res<span class="sc">$</span>p.value)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>tableau_trend <span class="ot">&lt;-</span> smp <span class="sc">%&gt;%</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tbl_summary</span>(</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">by =</span> age.t,</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">include =</span> depression,</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">statistic =</span> <span class="fu">all_categorical</span>() <span class="sc">~</span> <span class="st">"{n} / {N} ({p}%)"</span>,</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">percent =</span> <span class="st">"column"</span>,</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">missing =</span> <span class="st">"no"</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_p</span>(</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">test =</span> depression <span class="sc">~</span> <span class="st">"trend_test"</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>2 missing rows in the "age.t" column have been removed.</code></pre>
</div>
</div>
<table class="table caption-top">
<colgroup>
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Characteristic</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">(-Inf,25]<br>
N = 140</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">(25,50]<br>
N = 506</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">(50, Inf]<br>
N = 151</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">p-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left; width: 6cm;">depression</td>
<td style="text-align: center;">65 / 140 (46%)</td>
<td style="text-align: center;">202 / 506 (40%)</td>
<td style="text-align: center;">46 / 151 (30%)</td>
<td style="text-align: center;">0.005</td>
</tr>
</tbody><tfoot>
<tr class="odd">
<td style="text-align: left; padding: 0;"><sup>1</sup> n / N (%)</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
</tfoot>

</table>
<div style="page-break-after: always;"></div>
</section>
<section id="comparaison-de-2-moyennes" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="comparaison-de-2-moyennes"><span class="header-section-number">2.4</span> Comparaison de 2 moyennes</h2>
<p>Repose sur :</p>
<ul>
<li><p>le test t de Student pour échantillons indépendants (ou appariés)</p></li>
<li><p>le test de Welch (var.equal=FALSE dans R)</p></li>
<li><p>le test t de Student pour échantillons appariés (paired=TRUE dans R)</p></li>
<li><p>le test non paramétrique de Wilcoxon :</p>
<ul>
<li><p>test de Mann-Whitney pour échantillons indépendants</p></li>
<li><p>test de Wilcoxon pour échantillons appariés</p></li>
</ul></li>
</ul>
<p><strong>Test t de student pour échantillons indépendants</strong></p>
<p>Conditions de validité :</p>
<ul>
<li><p>Variable quantitative continue approximativement normale dans chaque groupe (mais en vrai s’il y a plus de 30 sujets par groupe, on peut s’en fiche un peu)</p></li>
<li><p>Homogénéité des variances dans chaque groupe (c’est à dire que les variances sont à peu près similaires)</p></li>
</ul>
<p>Pour apprécier la comparabilité des variances :</p>
<ul>
<li><p>diagramme de normalité (= QQ plot) (voir <code>qqnorm</code> et <code>qqline</code> en R) dans chaque groupe ou courbe de densité superposée à la loi normale (voir <code>density</code> et <code>lines</code> en R)</p></li>
<li><p>calcul des écarts-types dans chaque groupe (<code>by(var1, var2, sd, na.rm=TRUE)</code> en R)</p></li>
<li><p>test de Levene : bof bof parce que c’est comme Shapiro : si p &gt; 0,05 on conclut que les variances sont égales (ce qui n’est pas une preuve !) et si p &lt; 0,05 on conclut que les variances sont différentes (ce qui peut être dû à un petit échantillon</p></li>
</ul>
<p>Si les variances ne sont vraiment pas égales : utiliser le test de Welch (var.equal=FALSE dans R)</p>
<p>Conditions de validité :</p>
<ul>
<li><p>déjà : avec n&gt;30 par groupe, on s’en fiche un peu !! (sauf si différence ÉNORME de taille entre les groupes)</p></li>
<li><p>si &lt; 30 mais les groupes ont à peu près les mêmes effectifs + les mêmes distributions (11 et 13 sujets, écarts types similaires) : on peut s’en fiche aussi</p></li>
<li><p>la validité est douteuse si taille inégale ou distribution très différentes (30 vs 300 sujets, CRP négative vs 250 mg/L)</p></li>
</ul>
<p><strong>Si c’est vraiment très éloigné d’une distribution normale (comme le nombre d’enfants) : utiliser un test non paramétrique (Wilcoxon)</strong></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Wilcoxon / Mann Withney</strong></p>
<p><strong>Wilcoxon (<code>wilcox.test</code> en R)</strong></p>
<ul>
<li>peut être apparié → <code>paired = TRUE</code> (Wilcoxon signed‑rank)</li>
<li>ou non apparié → <code>paired = FALSE</code> (Mann‑Whitney / Wilcoxon rank‑sum)</li>
</ul>
<p><strong>Mann‑Whitney au sens strict</strong></p>
<ul>
<li>c’est la version non appariée seulement</li>
<li>pour deux groupes indépendants.</li>
<li>sur R : <code>wilcox.test(var1 ~ var2, data=..., paired=FALSE)</code></li>
</ul>
</div>
</div>
<section id="comparaison-de-2-moyennes-avec-r" class="level4" data-number="2.4.0.1">
<h4 data-number="2.4.0.1" class="anchored" data-anchor-id="comparaison-de-2-moyennes-avec-r"><span class="header-section-number">2.4.0.1</span> Comparaison de 2 moyennes avec R</h4>
<p>On teste l’</p>
<p>hypothèse : moyenne d’âge des détenus déprimés est différente de la moyenne d’âge des détenus non déprimés</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(smp<span class="sc">$</span>age <span class="sc">~</span> smp<span class="sc">$</span>depression, <span class="at">var.equal=</span><span class="cn">TRUE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Two Sample t-test

data:  smp$age by smp$depression
t = 2.6337, df = 795, p-value = 0.008611
alternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0
95 percent confidence interval:
 0.6425038 4.4032412
sample estimates:
mean in group 0 mean in group 1 
       39.93182        37.40895 </code></pre>
</div>
</div>
<p>La p value est de 0,0086 : on rejette l’hypothèse d’égalité des moyennes d’âge entre les deux groupes.</p>
<p>maginons maintenant que nous souhaitions comparer le nombre d’enfants des détenus selon qu’ils aient ou non été abusés dans leur enfance. Malgré la taille importante de l’échantillon, le fait que la distribution du nombre d’enfants soit très éloignée d’une distribution normale peut nous rendre réticent à l’idée d’utiliser un test t. L’alternative est alors de recourir à un test non paramétrique comme le test de Wilcoxon ou de Mann-Whitney</p>
<p>Si on veut comparer le nombre d’enfants entre les deux groupes de détenus (abusés ou non dans leur enfance) :</p>
<p>La distribution du nombre d’enfants est très asymétrique (beaucoup de zéros, quelques valeurs élevées)</p>
<p><span class="math inline">\(\rightarrow\)</span> on utilise un test non paramétrique = test de Wilcoxon / Mann-Whitney (en l’occurence Mann Whitney car les deux groupes sont indépendants)</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wilcox.test</span>(smp<span class="sc">$</span>nb.enfants<span class="sc">~</span>smp<span class="sc">$</span>abus.enfant, <span class="at">correct=</span><span class="cn">FALSE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Wilcoxon rank sum test

data:  smp$nb.enfants by smp$abus.enfant
W = 62664, p-value = 0.1938
alternative hypothesis: true location shift is not equal to 0</code></pre>
</div>
</div>
<p>NB : si on voulait en faisant paired = TRUE, il faut passer la syntaxe en mode vecteur (mais ça ne marcherait pas ici car les deux groupes ne sont pas appariés et donc n’ont pas le même effectif) :</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> smp<span class="sc">$</span>nb.enfants[smp<span class="sc">$</span>abus.enfant <span class="sc">==</span> <span class="dv">0</span>]  <span class="co"># groupe 0</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> smp<span class="sc">$</span>nb.enfants[smp<span class="sc">$</span>abus.enfant <span class="sc">==</span> <span class="dv">1</span>]  <span class="co"># groupe 1</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="fu">wilcox.test</span>(x, y, <span class="at">paired =</span> <span class="cn">TRUE</span>, <span class="at">correct =</span> <span class="cn">FALSE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Résumé des tests de comparaison de moyennes</strong></p>
<p>Comparaison de moyennes avec test t de Student :</p>
<ul>
<li><p>Effectif : &gt; 30 par groupe ou à peu près égaux (11 et 12 par exemple)</p></li>
<li><p>Distribution : symétrique (approximativement normale) et variances à peu près égales</p></li>
</ul>
<p>Si échantillons appariés : test t apparié, ou Wilcoxon apparié (= signed rank)</p>
<p>Si distribution très asymétrique : test non paramétrique de Mann-Whitney (= Wilcoxon non apparié = rank sum)</p>
<p>Si effectifs très inégaux ou variances très différentes : test de Welch</p>
</div>
</div>
<div style="page-break-after: always;"></div>
</section>
</section>
<section id="comparaison-de-3-moyennes-ou-plus" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="comparaison-de-3-moyennes-ou-plus"><span class="header-section-number">2.5</span> Comparaison de 3 moyennes ou plus</h2>
<p>Comparaison pas si fréquente (idem que la comparaison de 3 pourcentages).</p>
<p>Faire un test pour rejeter l’hypothèse <span class="math inline">\(\mu_1 = \mu_2 = \mu_3\)</span> a peu de sens !</p>
<p>Le test ANOVA (Analysis of Variance) permet de comparer les moyennes de plusieurs groupes (3 ou plus).</p>
<p>Si une variable à une distribution égale dans les 3 sous groupes, alors la variacnce intra-groupe doit être proche de la variance inter-groupe.</p>
<p>On passe par la comparaison des variances car on ne peut pas faire de comparaison directe des moyennes quand il y a plus de 2 groupes.</p>
<p>Le test ANOVA calcule le ratio de ces variances (F-statistique) et détermine la p-value associée en fonction de la distribution de F.</p>
<p><span class="math display">\[
F = \frac{\text{Variance inter-groupe}}{\text{Variance intra-groupe}}
\]</span></p>
<p>Exemple imagé :</p>
<ul>
<li><p>3 plantes (A, B, C) reçoivent 3 traitements différents (T1, T2, T3).</p></li>
<li><p>On mesure la hauteur des plantes après 1 mois..</p></li>
<li><p>On calcule la variance des hauteurs entre les groupes (inter-groupe) et la variance des hauteurs à l’intérieur de chaque groupe (intra-groupe).</p></li>
<li><p>Si les traitements n’ont pas d’effet, les variances inter et intra-groupe sont similaires.</p></li>
<li><p>Si un traitement a un effet, la variance inter-groupe sera plus grande que la variance intra-groupe.</p></li>
</ul>
<p>Conditions de validité :</p>
<ul>
<li><p>Indépendance des observations (pas de mesures répétées, pas de données appariées).</p></li>
<li><p>Variance de la variable étudiée similaire dans chaque groupe (homoscédasticité).</p></li>
<li><p>Normalité des résidus du modèle (avec la même résistance que pour le test t : si n&gt;30 par groupe et faible différences des deux groupes, on peut s’en fiche un peu).</p></li>
</ul>
<section id="exemple-r" class="level3" data-number="2.5.1">
<h3 data-number="2.5.1" class="anchored" data-anchor-id="exemple-r"><span class="header-section-number">2.5.1</span> Exemple R</h3>
<p>Exemple : niveau d’évitement du danger mesuré avec un questionnaire codée en 1, 2 et 3 pour des niveaux respectivement « faible », « modéré » ou « élevé ».</p>
<p>Il faut réfuter l’hypothèse que la moyenne d’âge est la même dans les trois groupes d’évitement du danger.</p>
<p>D’abord visualisation :</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(age <span class="sc">~</span> evit.danger, <span class="at">data =</span> smp,</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">"Évitement du danger"</span>,</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Âge"</span>,</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Âge selon l'évitement du danger"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="S1_3_Tests_statistiques_et_IC_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Les moyennes et écart-types d’âge semblent visuellement proches dans les trois groupes</p>
<p>Sur R, il faut passer par la fonction <code>lm</code> (linear model) pour faire une ANOVA :</p>
<p>Attention, il faut bien transformer la variable catégorielle en facteur avec <code>as.factor()</code> (sinon R la traite comme une variable quantitative continue !)</p>
<p>Syntaxe :</p>
<ul>
<li><p><code>lm(var_quantitative ~ var_catégorielle, data=...)</code></p></li>
<li><p>test : fonction <code>anova(...)</code> ou <code>drop1(..., test="F")</code></p></li>
</ul>
<p>La fonction <code>drop1</code> permet de tester l’effet d’une variable dans un modèle linéaire en comparant le modèle complet avec un modèle réduit (sans la variable testée).</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">lm</span>(age<span class="sc">~</span><span class="fu">as.factor</span>(evit.danger), <span class="at">data=</span>smp)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">drop1</span>(res, <span class="at">test=</span><span class="st">"F"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Single term deletions

Model:
age ~ as.factor(evit.danger)
                       Df Sum of Sq    RSS    AIC F value  Pr(&gt;F)  
&lt;none&gt;                              122212 3582.2                  
as.factor(evit.danger)  2    1062.1 123274 3584.2  2.9895 0.05097 .
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ou anova(res)</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(res)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: age
                        Df Sum Sq Mean Sq F value  Pr(&gt;F)  
as.factor(evit.danger)   2   1062  531.04  2.9895 0.05097 .
Residuals              688 122212  177.63                  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Lien entre ANOVA et régression linéaire</strong></p>
<p>Fondamentalement, l’ANOVA et la régression linéaire sont la même méthode mathématique (elles appartiennent toutes deux au “Modèle Linéaire Général”).</p>
<p>La différence est dans leur application :</p>
<ul>
<li><p>L’ANOVA est un cas particulier de régression utilisée quand les variables explicatives sont uniquement des catégories (des groupes comme “Engrais A, B, C”). Elle regarde si les moyennes de ces catégories diffèrent.</p></li>
<li><p>La Régression Linéaire est plus souple et permet d’utiliser des variables explicatives continues (des nombres comme la température ou l’âge) pour prédire une valeur.</p></li>
</ul>
<p>En résumé : faire une ANOVA revient exactement à faire une régression linéaire sur des variables catégorielles (transformées en variables “muettes” ou dummy variables).</p>
<p>Elles utilisent toutes les deux le même moteur : analyser la variance pour séparer le signal du bruit.</p>
</div>
</div>
<div style="page-break-after: always;"></div>
</section>
</section>
<section id="test-de-nullité-dun-coefficient-de-corrélation" class="level2" data-number="2.6">
<h2 data-number="2.6" class="anchored" data-anchor-id="test-de-nullité-dun-coefficient-de-corrélation"><span class="header-section-number">2.6</span> Test de nullité d’un coefficient de corrélation</h2>
<p>Les coefficients de corrélation mesurent la force et la direction d’une association linéaire entre deux variables quantitatives.</p>
<p>Ils peuvent être :</p>
<ul>
<li><p>Coefficient de corrélation de Pearson (r) : mesure la corrélation linéaire entre deux variables quantitatives continues. Varie entre -1 et +1.</p></li>
<li><p>Coefficient de corrélation de Spearman (ρ) : mesure la corrélation monotone entre deux variables, basé sur les rangs. Varie entre -1 et +1.</p></li>
<li><p>Coefficient kappa de Cohen (κ) : mesure l’accord entre deux évaluateurs pour des variables qualitatives. Varie entre -1 et +1.</p></li>
<li><p>Coefficient de corrélation intraclasse (ICC) : mesure la fiabilité entre plusieurs mesures quantitatives. Varie entre 0 et 1.</p></li>
</ul>
<p>Tester la nullité de corrélation revient à tester l’absence d’association linéaire entre les variables, c’est à dire leur indépendance linéaire.</p>
<p>(2 variables indépendantes ont nécessairement une absence de corrélation linéaire)</p>
<p><strong>Attention</strong> : tester la nullité d’une corrélation n’implique pas que le coefficient de corrélation soit = 0 !</p>
<p><strong>Attention aussi aux conditions de validité des coefficients</strong></p>
<p><strong>Attention aussi aux conditions de validité du test de nullité</strong></p>
<ul>
<li><p>Dans l’idéal : que <span class="math inline">\(X\)</span> et <span class="math inline">\(Y\)</span> soient distribuées normalement dans la population</p></li>
<li><p>Faisable quand même si <span class="math inline">\(X\)</span> est normale et <span class="math inline">\(Y\)</span> est binaire</p></li>
<li><p>Et même si les deux sont binaires !</p></li>
</ul>
<section id="test-de-nullité-du-coefficient-de-corrélation-avec-r" class="level3" data-number="2.6.1">
<h3 data-number="2.6.1" class="anchored" data-anchor-id="test-de-nullité-du-coefficient-de-corrélation-avec-r"><span class="header-section-number">2.6.1</span> Test de nullité du coefficient de corrélation avec R</h3>
<p>Utilisation de la fonction <code>cor.test(...)</code> :</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor.test</span>(smp<span class="sc">$</span>age, smp<span class="sc">$</span>recherche.nouv, <span class="at">method=</span><span class="st">"pearson"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's product-moment correlation

data:  smp$age and smp$recherche.nouv
t = -6.009, df = 693, p-value = 3.016e-09
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 -0.2920740 -0.1506631
sample estimates:
       cor 
-0.2225387 </code></pre>
</div>
</div>
<ul>
<li><p>Corrélation négative à -0,22 entre âge et recherche de nouveauté.</p></li>
<li><p>p-value &lt; 0,0001 : on rejette l’hypothèse d’absence de corrélation linéaire entre âge et recherche de nouveauté : <strong>il est très peu probable que les variables soient indépendantes linéairement</strong>.</p></li>
</ul>
<p><a href="https://thomashusson29.github.io/M2biostatistiques/S1_3bonus_correlation.html">Tableau corrélation</a></p>
</section>
</section>
<section id="tests-appariés-non-appariés" class="level2" data-number="2.7">
<h2 data-number="2.7" class="anchored" data-anchor-id="tests-appariés-non-appariés"><span class="header-section-number">2.7</span> Tests appariés / non appariés</h2>
<p>Exemple de données appariées :</p>
<ul>
<li><p>Mesures répétées sur les mêmes sujets (avant/après traitement).</p></li>
<li><p>Paires de sujets liés (jumeaux, couples).</p></li>
<li><p>Score de propension</p></li>
</ul>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Tests possibles sur données appariées :</strong></p>
<ul>
<li><p>Sur des moyennes :</p>
<ul>
<li><p>Test t apparié (paired=TRUE dans R) : avec conditions de validité du test t.</p></li>
<li><p>Test de Wilcoxon apparié (paired=TRUE dans R) : si conditions de validité du test t non remplies (surtout asymétrie évidente)</p></li>
</ul></li>
<li><p>Sur des pourcentages :</p>
<ul>
<li><p>Test du Chi2 de McNemar : pour comparer deux proportions appariées (ex : succès/échec avant/après traitement sur les mêmes sujets).</p></li>
<li><p>Test exact du Chi2 de McNemar : version exacte du test de McNemar, utilisé lorsque les effectifs sont petits.</p></li>
</ul></li>
</ul>
</div>
</div>
<section id="exemple-r-données-appariées" class="level3" data-number="2.7.1">
<h3 data-number="2.7.1" class="anchored" data-anchor-id="exemple-r-données-appariées"><span class="header-section-number">2.7.1</span> Exemple R données appariées</h3>
<section id="exemple-1" class="level4" data-number="2.7.1.1">
<h4 data-number="2.7.1.1" class="anchored" data-anchor-id="exemple-1"><span class="header-section-number">2.7.1.1</span> Exemple 1</h4>
<p>jeu de données <code>scl</code> : évolution au cours du temps du score SCL90 de patients déprimés hospitalisés</p>
<p>Objectif : tester l’hypothèse que le score SCL90 au jour 0 est différent du score SCL90 au jour 4</p>
<ol type="1">
<li>Visualisation des données</li>
</ol>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(scl)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  NUMERO   BIRTHDAT SEXE HEIGHT WEIGHT Q1 Q2 Q3 Q4 Q5 Q6 Q7 Q8 Q9 Q10 Q11 Q12
1      0 0073-06-18    2    157     56 NA NA NA NA NA NA NA NA NA  NA  NA  NA
3      3 0077-03-22    2    173     60  3  3  2  1  1  2  0  0  2   2   3   3
2      3 0077-03-22    2    173     60  2  4  2  1  3  0  0  0  2   2   3   4
4      3 0077-03-22    2    173     60  1  3  3  0  2  1  0  0  2   3   3   3
5      4       &lt;NA&gt;   NA     NA     NA  3  3  4  2  3  2  3  1  2   3   4   4
6      4       &lt;NA&gt;   NA     NA     NA  2  1  1  0  0  0  0  0  2   2   1   3
  Q13 Q14 Q15 Q16 Q17 Q18 Q19 Q20 Q21 Q22 Q23 Q24 Q25 Q26 Q27 Q28 Q29 Q30 Q31
1  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA
3   0   3   1   0   1   3   0   4   1   3   3   3   0   3   2   3   3   3   3
2   0   4   1   0   2   2   3   4   1   3   3   3   0   4   1   4   3   4   3
4   0   4   1   0   1   1   1   4   1   4   3   4   0   3   1   4   4   4   4
5   1   3   2   0   1   2   1   2   2   0   2   3   0   4   2   3   3   4   4
6   0   3   1   0   1   0   0   0   1   0   1   2   0   3   1   3   3   4   4
  Q32 Q33 Q34 Q35 Q36 Q37 Q38 Q39 Q40 Q41 Q42 Q43 Q44 Q45 Q46 Q47 Q48 Q49 Q50
1  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA
3   0   2   3   2   2   1   1   3   3   2   2   1   2   3   2   0   2   2   3
2   0   3   2   3   1   0   2   4   4   2   1   1   3   1   3   0   2   2   3
4   0   3   3   2   1   0   2   3   0   1   1   1   1   2   3   0   1   1   3
5   4   1   1   2   1   0   3   4   4   4   3   3   0   3   3   0   3   3   3
6   3   0   1   1   1   0   2   3   1   3   0   0   0   1   3   0   4   4   2
  Q51 Q52 Q53 Q54 Q55 Q56 Q57 Q58 Q59 Q60 Q61 Q62 Q63 Q64 Q65 Q66 Q67 Q68 Q69
1  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA
3   2   1   3   2   3   2   4   2   2   3   3   3   0   0   3   1   0   2   3
2   1   1   3   2   4   2   4   1   1   0   1   0   0   2   2   3   0   0   2
4   1   1   3   1   4   1   4   1   1   1   2   0   1   1   2   1   1   0   1
5   2   3   2   4   4   3   4   3   2   1   2   3   4   0   2   3   0   0   3
6   2   1   0   4   4   4   3   1   1   0   0   2   3   0   2   3   3   1   2
  Q70 Q71 Q72 Q73 Q74 Q75 Q76 Q77 Q78 Q79 Q80 Q81 Q82 Q83 Q84 Q85 Q86 Q87 Q88
1  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA
3   2   3   3   0   1   3   1   3   3   1   1   0   1   1   0   0   2   3   0
2   0   4   4   0   1   3   2   2   3   0   1   0   0   1   0   0   3   1   0
4   2   3   3   0   1   4   3   3   3   1   0   1   0   1   0   0   3   1   1
5   2   3   3   1   1   0   0   3   3   4   3   2   2   2   1   0   2   3   3
6   1   3   2   1   0   0   1   2   3   4   1   0   1   0   1   0   2   3   2
  Q89 Q90 age VISIT scl JOUR.VISIT somatisation obsession sensitivite
1  NA  NA  25  &lt;NA&gt;  NA          1           NA        NA          NA
3   1   3  21    J0 168          1           26        23          17
2   2   3  21    J4 164          5           24        23           9
4   3   1  21    J7 154          7           14        26          10
5   3   4  NA    J0 208          1           35        29          16
6   3   4  NA    J4 138          4           21        22           9
  depression anxiete hostilite phobie paranoia psychose divers
1         NA      NA        NA     NA       NA       NA     NA
3         30      25         7      9        8       14      9
2         35      31         7      6        6        9     14
4         35      26        11      9        6        8      9
5         40      26        14      8        8       22     10
6         32      17         9      4        2       15      7</code></pre>
</div>
</div>
<p>Transformer en format long avec <code>dcast</code> du package <code>reshape2</code> :</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>scl.w <span class="ot">&lt;-</span> <span class="fu">dcast</span>(</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>        scl[,<span class="fu">c</span>(<span class="st">"NUMERO"</span>,<span class="st">"VISIT"</span>,<span class="st">"depression"</span>)],</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>        NUMERO<span class="sc">~</span>VISIT, </span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">value.var=</span><span class="st">"depression"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>t-test apparié :</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(scl.w<span class="sc">$</span>J0, scl.w<span class="sc">$</span>J4, <span class="at">paired=</span><span class="cn">TRUE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Paired t-test

data:  scl.w$J0 and scl.w$J4
t = 6.2146, df = 99, p-value = 1.223e-08
alternative hypothesis: true mean difference is not equal to 0
95 percent confidence interval:
 3.172146 6.147854
sample estimates:
mean difference 
           4.66 </code></pre>
</div>
</div>
<p>p-value = 1.223e-08 : on rejette l’hypothèse d’égalité des moyennes de score SCL90 entre le jour 0 et le jour 4.</p>
</section>
<section id="exemple-2" class="level4" data-number="2.7.1.2">
<h4 data-number="2.7.1.2" class="anchored" data-anchor-id="exemple-2"><span class="header-section-number">2.7.1.2</span> Exemple 2</h4>
<p>Comparaison de pourcentages = test du Chi2 de McNemar</p>
<p>Ici, on teste l’hypothèse que la proportion de patients déprimés (score SCL90 &gt; 20) est la même au jour 0 et au jour 4.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">table</span>(scl.w<span class="sc">$</span>J0<span class="sc">&gt;</span><span class="dv">20</span>, scl.w<span class="sc">$</span>J4<span class="sc">&gt;</span><span class="dv">20</span>, <span class="at">deparse.level=</span><span class="dv">2</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>tab</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>             scl.w$J4 &gt; 20
scl.w$J0 &gt; 20 FALSE TRUE
        FALSE     9    0
        TRUE     16   75</code></pre>
</div>
</div>
<p>Le tableau de contingence montre que :</p>
<ul>
<li><p>9 patients ne sont pas déprimés aux jours 0 et 4.</p></li>
<li><p>75 patients sont déprimés aux jours 0 et 4.</p></li>
<li><p>16 patients sont déprimés au jour 0 mais pas au jour 4.</p></li>
<li><p>0 patients sont déprimés au jour 4 mais pas au jour 0.</p></li>
</ul>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcnemar.test</span>(tab, <span class="at">correct=</span><span class="cn">FALSE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    McNemar's Chi-squared test

data:  tab
McNemar's chi-squared = 16, df = 1, p-value = 6.334e-05</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>mcnemar.test(tab, correct=FALSE)</p>
</blockquote>
<pre><code>    McNemar's Chi-squared test</code></pre>
<p>data: tab McNemar’s chi-squared = 16, df = 1, p-value = 6.334e-05</p>
<p>p-value = 6.334e-05 : on rejette l’hypothèse d’égalité des proportions de patients déprimés entre le jour 0 et le jour 4.</p>
</section>
<section id="tbl_summary-apparié" class="level4" data-number="2.7.1.3">
<h4 data-number="2.7.1.3" class="anchored" data-anchor-id="tbl_summary-apparié"><span class="header-section-number">2.7.1.3</span> tbl_summary apparié</h4>
<p>On met les deux : comparaison de moyennes et comparaison de pourcentages</p>
<p>Après PSM :</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>table3adjusted <span class="ot">&lt;-</span> m.final <span class="sc">%&gt;%</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tbl_summary</span>(</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">include =</span> <span class="fu">all_of</span>(cols_to_include_in_table3),</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">missing =</span> <span class="st">"ifany"</span>,</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">by =</span> I_geste_comparaison_1HartmannCoelio,  <span class="co"># Comparaison entre groupes</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">percent =</span> <span class="st">"column"</span>,</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">statistic =</span> <span class="fu">list</span>(</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">all_categorical</span>() <span class="sc">~</span> <span class="st">"{n} ({p}%)"</span>,</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">all_continuous</span>() <span class="sc">~</span> <span class="st">"{median} [{p25}, {p75}]"</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_p</span>(</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">test =</span> <span class="fu">list</span>(</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>        <span class="fu">all_continuous</span>() <span class="sc">~</span> <span class="st">"paired.wilcox.test"</span>,  <span class="co"># Test de Wilcoxon pour les donnees continues</span></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">all_categorical</span>() <span class="sc">~</span> <span class="st">"mcnemar.test"</span>  <span class="co"># Test de McNemar pour les donnees categoriques</span></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">group =</span> Pair_ID  <span class="co"># Utilisation de l'ID de paire</span></span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Mais selon chat, utilisation de <code>group = Pair_ID</code> n’est pas très safe et conseille de faire comme ça :</p>
<ol type="1">
<li>Fonction Wilcoxon apparié personnalisée</li>
</ol>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>paired_wilcox_gts <span class="ot">&lt;-</span> <span class="cf">function</span>(data, variable, by, ...) {</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>    d <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(Pair_ID, <span class="fu">all_of</span>(by), <span class="fu">all_of</span>(variable)) <span class="sc">|&gt;</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>        tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">names_from =</span> <span class="sc">!!</span>rlang<span class="sc">::</span><span class="fu">sym</span>(by),</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">values_from =</span> <span class="sc">!!</span>rlang<span class="sc">::</span><span class="fu">sym</span>(variable)</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <span class="fu">wilcox.test</span>(d[[<span class="dv">1</span>]], d[[<span class="dv">2</span>]], <span class="at">paired =</span> <span class="cn">TRUE</span>)</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>    tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">p.value =</span> res<span class="sc">$</span>p.value)</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>    }</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ol start="2" type="1">
<li>Fonction McNemar personnalisée</li>
</ol>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>mcnemar_gts <span class="ot">&lt;-</span> <span class="cf">function</span>(data, variable, by, ...) {</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>    d <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(Pair_ID, <span class="fu">all_of</span>(by), <span class="fu">all_of</span>(variable)) <span class="sc">|&gt;</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>        tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">names_from =</span> <span class="sc">!!</span>rlang<span class="sc">::</span><span class="fu">sym</span>(by),</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">values_from =</span> <span class="sc">!!</span>rlang<span class="sc">::</span><span class="fu">sym</span>(variable)</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>    tab <span class="ot">&lt;-</span> <span class="fu">table</span>(d[[<span class="dv">1</span>]], d[[<span class="dv">2</span>]])</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <span class="fu">mcnemar.test</span>(tab, <span class="at">correct =</span> <span class="cn">FALSE</span>)</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>    tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">p.value =</span> res<span class="sc">$</span>p.value)</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>    }</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ol start="3" type="1">
<li>Fonction t de Student apparié personnalisée</li>
</ol>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>paired_ttest_gts <span class="ot">&lt;-</span> <span class="cf">function</span>(data, variable, by, ...) {</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>    d <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(Pair_ID, <span class="sc">!!</span>rlang<span class="sc">::</span><span class="fu">sym</span>(by), <span class="sc">!!</span>rlang<span class="sc">::</span><span class="fu">sym</span>(variable)) <span class="sc">%&gt;%</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>        tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">names_from  =</span> <span class="sc">!!</span>rlang<span class="sc">::</span><span class="fu">sym</span>(by),</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">values_from =</span> <span class="sc">!!</span>rlang<span class="sc">::</span><span class="fu">sym</span>(variable)</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <span class="fu">t.test</span>(d[[<span class="dv">1</span>]], d[[<span class="dv">2</span>]], <span class="at">paired =</span> <span class="cn">TRUE</span>)</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>    tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">p.value =</span> res<span class="sc">$</span>p.value)</span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>    }</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ol start="4" type="1">
<li>Tableau final</li>
</ol>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>table3adjusted <span class="ot">&lt;-</span> m.final <span class="sc">%&gt;%</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tbl_summary</span>(</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">include =</span> <span class="fu">all_of</span>(cols_to_include),</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">by =</span> colonne_de_comparaison,  <span class="co"># Comparaison entre groupes</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">percent =</span> <span class="st">"column"</span>,</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">statistic =</span> <span class="fu">list</span>(</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">all_categorical</span>() <span class="sc">~</span> <span class="st">"{n} ({p}%)"</span>,</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">all_continuous</span>()  <span class="sc">~</span> <span class="st">"{median} [{p25}, {p75}]"</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_p</span>(</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">test =</span> <span class="fu">list</span>(</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">all_continuous</span>()  <span class="sc">~</span> paired_wilcox_gts,   <span class="co"># ou paired_ttest_gts</span></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>        <span class="fu">all_categorical</span>() <span class="sc">~</span> mcnemar_gts</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div style="page-break-after: always;"></div>
</section>
</section>
</section>
</section>
<section id="calcul-de-beta-et-du-nombre-de-sujets-à-inclure" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Calcul de <span class="math inline">\(\beta\)</span> et du nombre de sujets à inclure</h1>
<p>Dans la théorie de Neyman et Pearson, le calcul du nombre de sujets à inclure dans une étude est directement lié au contrôle des risques <span class="math inline">\(\alpha\)</span> et <span class="math inline">\(\beta\)</span>.</p>
<p>Exemple : équiprobabilité des naissances de garçons (<span class="math inline">\(p_1\)</span>) et de filles (<span class="math inline">\(p_2\)</span>)</p>
<ul>
<li><p><span class="math inline">\(H_0\)</span> : <span class="math inline">\(p_1 = 0,5\)</span> (et donc <span class="math inline">\(p_2 = 0,5\)</span> également)</p></li>
<li><p><span class="math inline">\(H_1\)</span> : <span class="math inline">\(p_1 = 0,55\)</span> (et donc <span class="math inline">\(p_2 = 0,45\)</span>)</p></li>
</ul>
<p>Pour <span class="math inline">\(\alpha\)</span> fixé (par exemple à 5%), on peut déterminer une règle de décision (seuil critique) qui permet de rejeter <span class="math inline">\(H_0\)</span> si le pourcentage de naissances de garçons est suffisamment éloigné de 50%.</p>
<p><span class="math inline">\(\beta\)</span> varie</p>
<ul>
<li><p>la différence vraie : Plus l’effet réel est grand, plus il est facile à détecter, donc <span class="math inline">\(\beta\)</span> diminue (et la puissance augmente).</p></li>
<li><p>le nombre de sujets inclus : Plus on inclut de sujets, plus on a d’informations, donc <span class="math inline">\(\beta\)</span> diminue (et la puissance augmente).</p></li>
<li><p><span class="math inline">\(H_1\)</span> choisi : plus <span class="math inline">\(H_1\)</span> est proche de <span class="math inline">\(H_0\)</span>, plus il est difficile de détecter la différence, donc <span class="math inline">\(\beta\)</span> augmente (et la puissance diminue).</p></li>
</ul>
<p>Exemple :</p>
<ul>
<li>hypothèse <span class="math inline">\(p_1 = 0,55\)</span> <span class="math inline">\(\rightarrow\)</span> pour <span class="math inline">\(\alpha = 5\%\)</span> et <span class="math inline">\(\beta = 10\%\)</span></li>
</ul>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pwr.p.test</span>(<span class="at">h=</span><span class="fu">ES.h</span>(<span class="fl">0.5</span>,<span class="fl">0.55</span>),<span class="at">power=</span><span class="fl">0.9</span>,<span class="at">sig.level=</span><span class="fl">0.05</span>,<span class="at">alternative=</span><span class="st">"less"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
     proportion power calculation for binomial distribution (arcsine transformation) 

              h = -0.1001674
              n = 853.5244
      sig.level = 0.05
          power = 0.9
    alternative = less</code></pre>
</div>
</div>
<p>Pour <span class="math inline">\(p_1 = 0,55\)</span>, il faut environ 850 naissances pour obtenir une puissance de 90% avec un risque <span class="math inline">\(\alpha\)</span> de 5%.</p>
<ul>
<li>hypothèse <span class="math inline">\(p_1 = 0,60\)</span> <span class="math inline">\(\rightarrow\)</span> pour <span class="math inline">\(\alpha = 5\%\)</span> et <span class="math inline">\(\beta = 10\%\)</span></li>
</ul>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pwr.p.test</span>(<span class="at">h=</span><span class="fu">ES.h</span>(<span class="fl">0.5</span>,<span class="fl">0.60</span>),<span class="at">power=</span><span class="fl">0.9</span>,<span class="at">sig.level=</span><span class="fl">0.05</span>,<span class="at">alternative=</span><span class="st">"less"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
     proportion power calculation for binomial distribution (arcsine transformation) 

              h = -0.2013579
              n = 211.2183
      sig.level = 0.05
          power = 0.9
    alternative = less</code></pre>
</div>
</div>
<p>Pour <span class="math inline">\(p_1 = 0,60\)</span>, il faut environ 200 naissances pour obtenir une puissance de 90% avec un risque <span class="math inline">\(\alpha\)</span> de 5%.</p>
<ul>
<li>hypothèse <span class="math inline">\(p_1 = 0,52\)</span> <span class="math inline">\(\rightarrow\)</span> pour <span class="math inline">\(\alpha = 5\%\)</span> et <span class="math inline">\(\beta = 10\%\)</span></li>
</ul>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pwr.p.test</span>(<span class="at">h=</span><span class="fu">ES.h</span>(<span class="fl">0.5</span>,<span class="fl">0.52</span>),<span class="at">power=</span><span class="fl">0.9</span>,<span class="at">sig.level=</span><span class="fl">0.05</span>,<span class="at">alternative=</span><span class="st">"less"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
     proportion power calculation for binomial distribution (arcsine transformation) 

              h = -0.04001067
              n = 5349.549
      sig.level = 0.05
          power = 0.9
    alternative = less</code></pre>
</div>
</div>
<p>Pour <span class="math inline">\(p_1 = 0,52\)</span>, il faut environ 5000 naissances pour obtenir une puissance de 90% avec un risque <span class="math inline">\(\alpha\)</span> de 5%.</p>
<section id="exemple-r-1" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="exemple-r-1"><span class="header-section-number">3.1</span> Exemple R</h2>
<p>enons l’exemple d’un essai évaluant l’efficacité d’une nouvelle molécule dans le sepsis sévère (étude comparative versus placebo). Compte tenu des critères d’inclusion, les données épidémiologiques font état d’une mortalité à 30 jours (critère d’efficacité) égale à 36%.</p>
<p>Exemple : efficacité d’une nouvelle molédcule.</p>
<ul>
<li><p><span class="math inline">\(H_0\)</span> : mortalité = 36% (placebo)</p></li>
<li><p>Investigateurs : “ne pas passer à côté d’une baisse de 10 points de la mortalité”</p></li>
<li><p><span class="math inline">\(H_1\)</span> : mortalité = 26% (nouvelle molécule)</p></li>
<li><p><span class="math inline">\(\alpha\)</span> = 5% (risque de conclure à tort que la molécule est efficace)</p></li>
<li><p><span class="math inline">\(\beta\)</span> = 10% (risque de ne pas détecter l’efficacité de la molécule)</p></li>
</ul>
<p>La fonction <code>pwr.2p.test</code> du package <code>pwr</code> permet de calculer le nombre de sujets nécessaires pour atteindre la puissance désirée dans une étude comparant deux proportions.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pwr.2p.test</span>(</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">h =</span> <span class="fu">ES.h</span>(<span class="at">p1 =</span> <span class="fl">0.36</span>, <span class="at">p2 =</span> <span class="fl">0.26</span>), <span class="co"># taille d'effet</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">sig.level =</span> <span class="fl">0.05</span>, </span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">power=</span> <span class="fl">0.90</span>, </span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">alternative =</span> <span class="st">"two.sided"</span> </span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
     Difference of proportion power calculation for binomial distribution (arcsine transformation) 

              h = 0.2168606
              n = 446.8531
      sig.level = 0.05
          power = 0.9
    alternative = two.sided

NOTE: same sample sizes</code></pre>
</div>
</div>
<p>Il faut donc inclure environ 447 patients par groupe (soit un total de 894 patients) pour détecter une différence de mortalité de 10 points entre les deux groupes avec une puissance de 90% et un risque <span class="math inline">\(\alpha\)</span> de 5%.</p>
<div style="page-break-after: always;"></div>
</section>
</section>
<section id="tests-uni--ou-bilatéraux" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Tests uni- ou bilatéraux ?</h1>
<section id="définitions" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="définitions"><span class="header-section-number">4.1</span> Définitions</h2>
<ul>
<li><p>Selon Fisher :</p>
<ul>
<li><p>inférence statistique bilatérale par nature</p></li>
<li><p>on cherche à apprécier l’adéquation entre un échantillon observé et une population hypothétique infinie sous-jacente.</p></li>
<li><p>donc on teste toujours si l’estimateur issu de l’échantillon est suffisamment différent du paramètre de la population sous-jacente (qu’il soit supérieur ou inférieur).</p></li>
</ul></li>
<li><p>Selon Neyman et Pearson :</p>
<ul>
<li>inférence statistique unilatérale inférieure ou supérieure selon le choix des hypothèses <span class="math inline">\(H_0\)</span> et <span class="math inline">\(H_1\)</span>.</li>
</ul></li>
</ul>
</section>
<section id="exemple" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="exemple"><span class="header-section-number">4.2</span> Exemple</h2>
<ol type="1">
<li>Essai randomisé : on teste</li>
</ol>
<ul>
<li><p><span class="math inline">\(H_0\)</span> : la nouvelle thérapeutique n’est pas plus efficace que le placebo</p></li>
<li><p><span class="math inline">\(H_1\)</span> : la nouvelle thérapeutique est plus efficace que le placebo</p></li>
</ul>
<p>Mais on teste pas l’infériorité de la nouvelle thérapeutique par rapport au placebo.</p>
<p>Donc en soit, c’est un test unilatéral supérieur, et le risque de première espèce <span class="math inline">\(\alpha\)</span> est à 2,5% (et non 5%).</p>
<ol start="2" type="1">
<li>Étude d’<strong>inférence inductive</strong> : on teste</li>
</ol>
<ul>
<li><p>Formulation bilatéral</p></li>
<li><p>Avec le risque de première espèce <span class="math inline">\(\alpha\)</span> égal à 5%.</p></li>
</ul>
<div style="page-break-after: always;"></div>
</section>
</section>
<section id="intervalles-de-confiance" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Intervalles de confiance</h1>
<section id="définitions-1" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="définitions-1"><span class="header-section-number">5.1</span> Définitions</h2>
<p>“Vraie valeur” de la moyenne = espérance de la moyenne =</p>
<p><span class="math display">\[
\mu \text{ +/- } \frac{\sigma}{\sqrt{n}}
\]</span></p>
<p>Avec : <span class="math inline">\(\sigma\)</span> = écart-type de la population et <span class="math inline">\(n\)</span> = taille de l’échantillon</p>
<p>En fait :</p>
<ul>
<li><p>Si âge : 40 [37-43] ans dans un échantillon de 100 personnes</p></li>
<li><p>C’est l’intervalle de confiance qui a 95% de chances de contenir la vraie valeur de la moyenne d’âge dans la population.</p></li>
<li><p>et pas “il y a 95% des valeurs de l’échantillon qui sont entre 37 et 43 ans”.</p></li>
</ul>
<p>L’intervalle de confiance à 95% correspond à la grande majorité (95%) des valeurs <strong>théoriques possibles</strong> de ce paramètre, compatibles avec l’échantillon observé.</p>
<p>Pour observer les fluctuations de l’estimation d’un paramètre dans un échantillon donné, il faut utiliser les intervalles empiriques ou les intervalles de fluctuation.</p>
<p>En gardant à l’esprit que les observations sont considérées implicitement comme un échantillon aléatoire issu d’une population sous-jacente alors que ça n’est que rarement le cas dans les faits !</p>
</section>
<section id="exemple-r-2" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="exemple-r-2"><span class="header-section-number">5.2</span> Exemple R</h2>
<p>Prévalence de la schizophrénie dans l’étude <code>smp</code>.</p>
<p>FOnction <code>binom.confint()</code> de la bibliothèque <code>binom</code> de R permet d’estimer la prévalence et un intervalle de confiance.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(smp<span class="sc">$</span>schizophrenie)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="fu">binom.confint</span>(<span class="at">x=</span><span class="fu">sum</span>(y), <span class="at">n=</span><span class="fu">length</span>(y), <span class="at">method=</span><span class="st">"asymptotic"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>      method  x   n       mean      lower      upper
1 asymptotic 64 799 0.08010013 0.06127831 0.09892194</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Prévalence de la schizophrénie : "</span>,</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">round</span>(<span class="fu">binom.confint</span>(<span class="at">x=</span><span class="fu">sum</span>(y), <span class="at">n=</span><span class="fu">length</span>(y), <span class="at">method=</span><span class="st">"asymptotic"</span>)<span class="sc">$</span>mean<span class="sc">*</span><span class="dv">100</span>,<span class="dv">2</span>),</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"% ["</span>,</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">round</span>(<span class="fu">binom.confint</span>(<span class="at">x=</span><span class="fu">sum</span>(y), <span class="at">n=</span><span class="fu">length</span>(y), <span class="at">method=</span><span class="st">"asymptotic"</span>)<span class="sc">$</span>lower<span class="sc">*</span><span class="dv">100</span>,<span class="dv">2</span>),</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"% ; "</span>,</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">round</span>(<span class="fu">binom.confint</span>(<span class="at">x=</span><span class="fu">sum</span>(y), <span class="at">n=</span><span class="fu">length</span>(y), <span class="at">method=</span><span class="st">"asymptotic"</span>)<span class="sc">$</span>upper<span class="sc">*</span><span class="dv">100</span>,<span class="dv">2</span>),</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"%]"</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Prévalence de la schizophrénie :  8.01 % [ 6.13 % ;  9.89 %]</code></pre>
</div>
</div>
<p>Donc l’échantillon observé est compatible avec des populations infinies sous-jacentes pour lesquelles la « vraie » prévalence de schizophrénie serait comprise entre 6,1% et 9,9%.</p>
<p>Le truc c’est qu’on a fait un sondage en grappe, donc il faut utiliser la bibliothèque <code>survey</code> de R pour calculer un intervalle de confiance correct.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>smp.design <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">ids=</span><span class="sc">~</span><span class="dv">1</span>, <span class="at">data=</span>smp)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in svydesign.default(ids = ~1, data = smp): No weights or probabilities
supplied, assuming equal probability</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">svyciprop</span>(<span class="sc">~</span>schizophrenie, smp.design, <span class="at">na.rm=</span><span class="cn">TRUE</span>, <span class="at">method=</span><span class="st">"beta"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                       2.5%  97.5%
schizophrenie 0.0801 0.0622 0.1012</code></pre>
</div>
</div>
<p>Sur une variable quantitative : fonction <code>t.test()</code> de R permet d’estimer la moyenne et un intervalle de confiance.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Moyenne d'âge : "</span>,</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">round</span>(<span class="fu">t.test</span>(smp<span class="sc">$</span>age)<span class="sc">$</span>estimate,<span class="dv">2</span>),</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">" ans ["</span>,</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">round</span>(<span class="fu">t.test</span>(smp<span class="sc">$</span>age)<span class="sc">$</span>conf.int[<span class="dv">1</span>],<span class="dv">2</span>),</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">" ans ; "</span>,</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">round</span>(<span class="fu">t.test</span>(smp<span class="sc">$</span>age)<span class="sc">$</span>conf.int[<span class="dv">2</span>],<span class="dv">2</span>),</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">" ans]"</span></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Moyenne d'âge :  38.94  ans [ 38.02  ans ;  39.86  ans]</code></pre>
</div>
</div>
<p>Et pour sondage en grappe :</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>modsvy <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(age<span class="sc">~</span><span class="dv">1</span>, <span class="at">design=</span>smp.design)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(modsvy)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>               2.5 %   97.5 %
(Intercept) 38.01932 39.86273</code></pre>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>