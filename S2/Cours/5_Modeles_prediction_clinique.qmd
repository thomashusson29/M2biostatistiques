---
title: "Modèles de prédiction clinique"
bibliography: Biblio/biblio_zotero.bib
format:
    pdf:
        toc: true
        toc-depth: 2
        toc-title: "Table des matières"
        number-sections: false
        mainfont: Ubuntu
        filters:
            - level6-heading.lua
        header-includes: |
            \usepackage{fontspec}
            \setmainfont{Ubuntu}
            \usepackage[dvipsnames]{xcolor}
            \usepackage{array}
            \usepackage{etoolbox}
            \usepackage{needspace}
            \definecolor{myblue}{rgb}{0.0078,0.0078,0.549}
            \definecolor{mygreen}{rgb}{0,0.2745,0}
            \definecolor{mybrown}{rgb}{0.392,0.094,0.094}
            \definecolor{mypurple}{rgb}{0.286,0,0.286}
            \definecolor{myorange}{rgb}{0.8,0.4,0}
            \usepackage{sectsty}
            \sectionfont{\color{black}\Large}
            \subsectionfont{\color{myblue}\large}
            \subsubsectionfont{\color{mygreen}\normalsize}
            % Espace vertical de 0.3 cm haut/bas dans les cellules de tableau
            \setlength{\extrarowheight}{0.3cm}
            % Fixe la taille du corps de texte à 10pt avec un interligne cohérent
            \AtBeginDocument{\fontsize{10pt}{12pt}\selectfont}
            % Assure une vraie hiérarchie (### vs ####) dans le PDF
            \setcounter{secnumdepth}{5}
            \setcounter{tocdepth}{5}
            % Avec KOMA-Script (scrartcl), éviter titlesec (incompatible) et
            % redéclarer paragraph/subparagraph pour qu'ils soient en "block".
            \RedeclareSectionCommand[
                beforeskip=1.5ex plus .5ex minus .2ex,
                afterskip=.6ex,
                font=\normalfont\small\bfseries\color{mybrown}
            ]{paragraph}
            \RedeclareSectionCommand[
                beforeskip=1.2ex plus .4ex minus .2ex,
                afterskip=.5ex,
                font=\normalfont\footnotesize\bfseries\color{mypurple}
            ]{subparagraph}
            % Niveau 6 (######) - titre personnalisé
            \newcommand{\subsubparagraph}[1]{%
                \vspace{1ex}%
                {\normalfont\scriptsize\bfseries\color{myorange}#1}%
                \vspace{0.4ex}%
            }
            % Veille à laisser suffisamment d'espace avant un tableau pour éviter son découpage
            \AtBeginEnvironment{longtable}{\needspace{15\baselineskip}}
    html:
        toc: true
        toc-location: left
        toc-expand: true
        css: heading-colors.css
        include-after-body: markmap-link.html
        post-render:
            - "python3 post-render.py"
post-render:
    - "python3 post-render.py"
---

```{r}
#| label: setup
#| include: false
#| echo: false
library(forecast)
library(plotrix)
library(randomForest)
library(tidyr)
library(epiR)
library(DHARMa)
library(viridisLite)
library(ggplot2)
library(binom)
library(survminer)
library(pROC)
library(treemap)
library(boot)
library(psy)
library(MASS)
library(mgcv)
library(rpart)
library(logbin)
library(rpart.plot)
library(plotly)
library(lmerTest)
library(psych)
library(lme4)
library(prettyR)
library(kableExtra)
library(gtsummary)
library(dplyr)
library(lattice)
library(survey)
library(mice)
library(qgraph)
library(nlme)
library(pwr)
library(guideR)
library(ape)
library(survival)
library(gmodels)
library(httpgd)
library(e1071)
library(psy)
library(reshape2)
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(fig.height = 6)
```

## Modèles de prédiction clinique

#### Utilité des facteurs pronostiques dans les modèles de prédiction clinique

-   Classification de la maladie au diagnostic

-   Prédiction de l’évolution de la maladie (risque absolu)

-   Informer la gestion clinique

-   Prévision individuelle plus précise du risque

-   Stratifier les patients dans les essais cliniques

#### Différents types de modèles de prédiction clinique

-   Modèles explicatifs : mettent en évidence les facteurs de risque et leur contribution à la maladie

-   Modèles prédictifs : se concentrent sur la précision de la prédiction, indépendamment de l’interprétabilité (pas de préoccupation au sujet de la causalité ou de la confusion)

-   Modèles descriptifs : résument les données sans nécessairement faire de prédictions

## Dévelopmment d'un modèle de prédiction clinique : étape par étape 

1.  **Définir les objectifs et rédiger un protocole détaillé**

2.  **Choisir entre le développement d’un nouveau modèle ou la mise à jour d’un modèle existant**

3.  **Spécifier le critère de jugement principal (outcome)**

4.  **Lister les prédicteurs candidats et décrire leurs méthodes de mesure**

5.  **Déterminer la taille d’échantillon nécessaire**

6.  **Recueillir les données et vérifier leur qualité**

7.  **Traiter les données manquantes (imputation, exclusions justifiées, etc.)**

8.  **Ajuster les modèles de prédiction (développement ou mise à jour)**

9.  **Évaluer la performance des modèles : discrimination, calibration, utilité clinique**

10.  **Comparer les modèles et sélectionner la version finale**

11.  **Effectuer une analyse de la courbe décisionnelle pour estimer l’impact clinique**

12.  **Rédiger et publier les résultats** (inclure, si pertinent, une analyse facultative de la contribution individuelle de chaque prédicteur)

#### Objectifs d'un modèle de prédiction clinique

-   Population cible : pour qui le modèle doit prévoir ?

-   Quel critère d'évaluation faut-il prévoir ?

-   Utilisateur : qui va utiliser le modèle ? (cliniciens, patients, systèmes de santé)

-   Décisions cliniques que le modèle doit informer (traitement, dépistage, suivi)

#### Choix entre développement d’un nouveau modèle ou mise à jour d’un modèle existant

-   Revue de la littérature pour identifier les modèles existants.

-   PROBAST : outil de validation critique pour évaluer la qualité méthodologique des modèles de prédiction existants (permet d’identifier les risques de biais et les problèmes de validité).

    -   Risques de biais : par ex overfitting, sélection des prédicteurs, gestion des données manquantes, etc.

    -   Applicabilité : évaluer si le modèle est pertinent pour la population cible, les prédicteurs disponibles, les critères d’évaluation, etc.

-   Pourquoi pas évaluer la validité d'un modèle existant dans la population cible avant de développer un nouveau modèle ?

-   Selon résultats de la validation, décider de développer un nouveau modèle ou de mettre à jour un modèle existant (ajout de nouveaux prédicteurs, recalibrage, etc.)


#### Définition d'un critère de jugement pour un modèle de prédiction clinique

-   Réponse binaire si temps bref ou simultanéité (ex. présence d’une maladie)

-   Réponse quantitative si état fonctionnel, qualit de vie, taille tumeur...

-   Etc etc

#### Détermination des prédicteurs possibles et préciser les méthodes de mesure pour un modèle de prédiction clinique

-   Prédicteurs : idéalement définis et mesurés objectivement, de manière fiable et reproductible, et disponibles au moment de la prise de décision clinique.

-   Dichotomosation / catégorisation des prédicteurs continus réduit l'information et la puissance statistique

#### Taille d’échantillon nécessaire pour développer un modèle de prédiction clinique

-   Règle empirique : au moins 10 événements par prédicteur (EPV) pour les modèles de régression logistique (ex. 100 événements pour 10 prédicteurs)

-   4 critères : 

    -   Estimation de l'incidence

    -   Estimation des prédictions individuelles

    -   Pas trop de sur-ajustement (overfitting) (a posteriori ou lors de la modélisation (lasso, ridge, etc.))

    -   Corriger le sur-ajustement de manière un peu systématique

-   Référence : Riley et al. (2020) "Calculating the sample size required for developing a clinical prediction model" BMJ 368:m441. https://doi.org/10.1136/bmj.m441 @riley2020

#### Recueil des données et vérification de leur qualité pour un modèle de prédiction clinique

-   Idéal = cohorte prospective avec collecte de données standardisée

-   Mais difficiles à mettre en place, coûteuses, longues

-   Erreurs de données : essayer de standardiser

-   Exploration des données : prédicteur avec faible variabilité dans le jeu de données ? Mutation avec fréquence faible ? Prédicteur avec beaucoup de données manquantes ? Etc.

#### Modèles de prédiction : quels modèles ?

-   Si taille grande : termes non linéaires (eg splines), interactions

-   Modèles IA / machine learning : random forest, gradient boosting, réseaux de neurones, etc.

-   Mais première étape : **pénalisation** de modèles (avant de passer à des modèles plus complexes) : lasso, ridge, elastic net, etc.

-   Dans tous les cas : vérifier les hypothèses des modèles : 

    -   Modèle linéaire général : 

        -   Indépendance des résidus

        -   Homoscédasticité (variance constante des résidus)

        -   Normalité des résidus

    -   Linéaritié (pour les prédicteurs continus)

    -   Additivité = absence d’interactions (sauf si spécifiées)

    -   Survie : proportionalité des risques (Cox), etc.

-   Étude de l'adéquation du modèle :

-   Processus diagnostique ou utilisation des résidus pour évaluer les hypothèses du modèle :

    -   Résidus vs prédictions ajustées

    -   Résidus vs prédicteurs

    -   Q-Q plot des résidus

Arrêté à 31:00