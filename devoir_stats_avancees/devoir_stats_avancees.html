<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Thomas Husson, Groupe 52">

<title>Devoir Statistiques Avancées</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="devoir_stats_avancees_files/libs/clipboard/clipboard.min.js"></script>
<script src="devoir_stats_avancees_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="devoir_stats_avancees_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="devoir_stats_avancees_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="devoir_stats_avancees_files/libs/quarto-html/popper.min.js"></script>
<script src="devoir_stats_avancees_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="devoir_stats_avancees_files/libs/quarto-html/anchor.min.js"></script>
<link href="devoir_stats_avancees_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="devoir_stats_avancees_files/libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="devoir_stats_avancees_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="devoir_stats_avancees_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="devoir_stats_avancees_files/libs/bootstrap/bootstrap-d6a003b94517c951b2d65075d42fb01b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#énoncé-et-présentation-des-échelles" id="toc-énoncé-et-présentation-des-échelles" class="nav-link active" data-scroll-target="#énoncé-et-présentation-des-échelles"><span class="header-section-number">1</span> Énoncé et présentation des échelles</a>
  <ul>
  <li><a href="#énoncé-du-devoir" id="toc-énoncé-du-devoir" class="nav-link" data-scroll-target="#énoncé-du-devoir"><span class="header-section-number">1.1</span> Énoncé du devoir</a></li>
  <li><a href="#échelles" id="toc-échelles" class="nav-link" data-scroll-target="#échelles"><span class="header-section-number">1.2</span> Échelles</a></li>
  </ul></li>
  <li><a href="#gestion-des-données" id="toc-gestion-des-données" class="nav-link" data-scroll-target="#gestion-des-données"><span class="header-section-number">2</span> Gestion des données</a>
  <ul>
  <li><a href="#présentation-des-fichiers-de-données" id="toc-présentation-des-fichiers-de-données" class="nav-link" data-scroll-target="#présentation-des-fichiers-de-données"><span class="header-section-number">2.1</span> Présentation des fichiers de données</a>
  <ul>
  <li><a href="#fichier-hamilton" id="toc-fichier-hamilton" class="nav-link" data-scroll-target="#fichier-hamilton"><span class="header-section-number">2.1.1</span> Fichier Hamilton</a></li>
  <li><a href="#fichier-scl90" id="toc-fichier-scl90" class="nav-link" data-scroll-target="#fichier-scl90"><span class="header-section-number">2.1.2</span> Fichier scl90</a></li>
  <li><a href="#fichier-groupe" id="toc-fichier-groupe" class="nav-link" data-scroll-target="#fichier-groupe"><span class="header-section-number">2.1.3</span> Fichier groupe</a></li>
  </ul></li>
  <li><a href="#import-des-données-et-data-management" id="toc-import-des-données-et-data-management" class="nav-link" data-scroll-target="#import-des-données-et-data-management"><span class="header-section-number">2.2</span> Import des données et data management</a>
  <ul>
  <li><a href="#scl90" id="toc-scl90" class="nav-link" data-scroll-target="#scl90"><span class="header-section-number">2.2.1</span> SCL90</a></li>
  <li><a href="#hdrs" id="toc-hdrs" class="nav-link" data-scroll-target="#hdrs"><span class="header-section-number">2.2.2</span> HDRS</a></li>
  <li><a href="#groupes" id="toc-groupes" class="nav-link" data-scroll-target="#groupes"><span class="header-section-number">2.2.3</span> Groupes</a></li>
  <li><a href="#fusion-des-3-fichiers" id="toc-fusion-des-3-fichiers" class="nav-link" data-scroll-target="#fusion-des-3-fichiers"><span class="header-section-number">2.2.4</span> Fusion des 3 fichiers</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#question-1-validation-de-léchelle-hamilton" id="toc-question-1-validation-de-léchelle-hamilton" class="nav-link" data-scroll-target="#question-1-validation-de-léchelle-hamilton"><span class="header-section-number">3</span> Question 1 : Validation de l’échelle Hamilton</a>
  <ul>
  <li><a href="#valdidation.à-j0" id="toc-valdidation.à-j0" class="nav-link" data-scroll-target="#valdidation.à-j0"><span class="header-section-number">3.1</span> Valdidation.à J0</a>
  <ul>
  <li><a href="#description" id="toc-description" class="nav-link" data-scroll-target="#description"><span class="header-section-number">3.1.1</span> Description</a></li>
  <li><a href="#validité-interne-structure-dimensionnelle-analyse-factorielle" id="toc-validité-interne-structure-dimensionnelle-analyse-factorielle" class="nav-link" data-scroll-target="#validité-interne-structure-dimensionnelle-analyse-factorielle"><span class="header-section-number">3.1.2</span> Validité interne : structure dimensionnelle, analyse factorielle</a></li>
  <li><a href="#validité-externe" id="toc-validité-externe" class="nav-link" data-scroll-target="#validité-externe"><span class="header-section-number">3.1.3</span> Validité externe</a></li>
  </ul></li>
  <li><a href="#validation-à-j56" id="toc-validation-à-j56" class="nav-link" data-scroll-target="#validation-à-j56"><span class="header-section-number">3.2</span> Validation à J56</a>
  <ul>
  <li><a href="#description-1" id="toc-description-1" class="nav-link" data-scroll-target="#description-1"><span class="header-section-number">3.2.1</span> Description</a></li>
  <li><a href="#validité-interne-structure-dimensionnelle-analyse-factorielle-1" id="toc-validité-interne-structure-dimensionnelle-analyse-factorielle-1" class="nav-link" data-scroll-target="#validité-interne-structure-dimensionnelle-analyse-factorielle-1"><span class="header-section-number">3.2.2</span> Validité interne : structure dimensionnelle, analyse factorielle</a></li>
  <li><a href="#validité-externe-1" id="toc-validité-externe-1" class="nav-link" data-scroll-target="#validité-externe-1"><span class="header-section-number">3.2.3</span> Validité externe</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#question-2-comparaison-de-la-réponse-au-traitement-entre-deux-groupes-de-patients" id="toc-question-2-comparaison-de-la-réponse-au-traitement-entre-deux-groupes-de-patients" class="nav-link" data-scroll-target="#question-2-comparaison-de-la-réponse-au-traitement-entre-deux-groupes-de-patients"><span class="header-section-number">4</span> Question 2 : Comparaison de la réponse au traitement entre deux groupes de patients</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="devoir_stats_avancees.docx"><i class="bi bi-file-word"></i>MS Word</a></li><li><a href="../devoir_stats_avancees.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Devoir Statistiques Avancées</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Thomas Husson, Groupe 52 </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<div style="page-break-after: always;"></div>
<section id="énoncé-et-présentation-des-échelles" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Énoncé et présentation des échelles</h1>
<section id="énoncé-du-devoir" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="énoncé-du-devoir"><span class="header-section-number">1.1</span> Énoncé du devoir</h2>
<p>Consigne :</p>
<ul>
<li><p>Étude d’épidémiologie clinique avec mesures répétées</p></li>
<li><p>Données :</p>
<ul>
<li><p>146 patients déprimés</p></li>
<li><p>Évaluations à J0, J4, J7, J14, J21, J28, J42, J56</p></li>
<li><p>Autoévaluation (SCL90) et hétéroévaluation (échelle de dépression de Hamilton)</p></li>
</ul></li>
<li><p>Questions :</p>
<ol type="1">
<li><p>Validation de l’échelle de dépression de Hamilton aux temps J0 et J56</p></li>
<li><p>Comparaison de la réponse au traitement entre deux groupes de patients (groupe=0 et groupe=1) en utilisant le score brut de Hamilton avec une approche LOCF puis un modèle mixte</p></li>
<li><p>Réponse à la question 2 en utilisant un critère binaire censuré « réponse au traitement » défini par une chute de 50% à l’échelle de Hamilton par rapport à J0</p></li>
</ol></li>
<li><p>Fichiers :</p>
<ul>
<li><p>Fichier groupe (<code>outil groupe.xlsx</code>) (2 sous-groupes de patients)</p></li>
<li><p>Fichier autoévaluation (<code>outil autoeval.xlsx</code>) (SCL 90)</p></li>
<li><p>Fichier hdrs (<code>outil hdrs.xlsx</code>) (échelle de Hamilton)</p></li>
</ul></li>
</ul>
</section>
<section id="échelles" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="échelles"><span class="header-section-number">1.2</span> Échelles</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 10%">
<col style="width: 45%">
<col style="width: 45%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>Échelle de Hamilton (HDRS)</th>
<th>Échelle SCL90</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Objectif</td>
<td>Mesure l’intensité de la symptomatologie dépressive</td>
<td>“Inconfort psychopathologique” selon plusieurs dimensions.</td>
</tr>
<tr class="even">
<td>Type</td>
<td>Hétéro-évaluation</td>
<td>Autoévaluation</td>
</tr>
<tr class="odd">
<td>Méthode</td>
<td>17 items codés de 2 à 4<br><br>- Score ≤ 7 : pas de dépression clinique<br>- Score 8–15 : dépression mineure<br>- Score &gt; 15 : dépression majeure</td>
<td>10 dimensions : somatisation, symptômes obsessionnels, sensibilité interpersonnelle, dépression, anxiété, hostilité, phobies, traits paranoïaques, traits psychotiques et symptômes divers.</td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</section>
</section>
<section id="gestion-des-données" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Gestion des données</h1>
<section id="présentation-des-fichiers-de-données" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="présentation-des-fichiers-de-données"><span class="header-section-number">2.1</span> Présentation des fichiers de données</h2>
<p>Les 3 fichiers sont en format “large” : chaque ligne correspond à une visite d’un patient et une colonne par item de l’échelle (sauf l’item 16 = PERTE DE POIDS qui est codé en deux variables HAMD16A et HAMD16B dans l’échelle de Hamilton, selon que la perte de poids est déclarée par le patient ou appréciée par le médecin)</p>
<p>On créera donc une colonne <code>hdrs$HAMD16</code> qui prendra la valeur de <code>hdrs$HAMD16A</code> si elle est remplie, sinon la valeur de <code>hdrs$HAMD16B</code>.</p>
<section id="fichier-hamilton" class="level3" data-number="2.1.1">
<h3 data-number="2.1.1" class="anchored" data-anchor-id="fichier-hamilton"><span class="header-section-number">2.1.1</span> Fichier Hamilton</h3>
<ul>
<li><p>1053 observations, 20 variables pour 146 patients</p></li>
<li><p>On ajoute une colonne <code>score</code> qui contient le score total de l’échelle de Hamilton (somme des items)</p></li>
<li><p>Les données d’une ligne (J7 du 128ème patient) sont manquantes <span class="math inline">\(\rightarrow\)</span> on supprime cette ligne.</p></li>
</ul>
</section>
<section id="fichier-scl90" class="level3" data-number="2.1.2">
<h3 data-number="2.1.2" class="anchored" data-anchor-id="fichier-scl90"><span class="header-section-number">2.1.2</span> Fichier scl90</h3>
<ul>
<li><p>1034 observations, 92 variables, 146 patients.</p></li>
<li><p>On crée 10 nouvelles variables représentant les scores moyen des 10 dimensions de l’échelle SCL90.</p></li>
<li><p>Données aberrantes parfois, qui sont recodées en données manquantes et représentent ainsi 0.6% des données totales.</p></li>
</ul>
</section>
<section id="fichier-groupe" class="level3" data-number="2.1.3">
<h3 data-number="2.1.3" class="anchored" data-anchor-id="fichier-groupe"><span class="header-section-number">2.1.3</span> Fichier groupe</h3>
<ul>
<li><p>Répartit les 146 patients en 2 groupes (1 et 0)</p></li>
<li><p>Pas de NA</p></li>
</ul>
</section>
</section>
<section id="import-des-données-et-data-management" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="import-des-données-et-data-management"><span class="header-section-number">2.2</span> Import des données et data management</h2>
<p>Les données sont importées à partir de fichiers Excel.</p>
<section id="scl90" class="level3" data-number="2.2.1">
<h3 data-number="2.2.1" class="anchored" data-anchor-id="scl90"><span class="header-section-number">2.2.1</span> SCL90</h3>
<p>Le jeu de données <code>scl90</code> est traité de la manière suivante :</p>
<ul>
<li><p>Visites ordonnées chronologiquement</p></li>
<li><p>Identification des doublons</p></li>
<li><p>Visualisation et gestion des données aberrantes</p></li>
<li><p>Imputation des données manquantes par le mode pour chaque question</p></li>
<li><p>Création des scores moyens par dimension (10 dimensions)</p></li>
<li><p>Nouveau dataframe <code>scl90_dim</code> avec uniquement les 10 dimensions</p></li>
</ul>
</section>
<section id="hdrs" class="level3" data-number="2.2.2">
<h3 data-number="2.2.2" class="anchored" data-anchor-id="hdrs"><span class="header-section-number">2.2.2</span> HDRS</h3>
<p>Le jeu de données <code>hdrs</code> est traité de la manière suivante :</p>
<ul>
<li><p>Visites ordonnées chronologiquement</p></li>
<li><p>Identification des doublons</p></li>
<li><p>Fusion des variables HAMD16A et HAMD16B en une seule variable HAMD16</p></li>
<li><p>Création du score total HDRS (ajouté dans la colonne <code>hdrs$score</code>)</p></li>
</ul>
</section>
<section id="groupes" class="level3" data-number="2.2.3">
<h3 data-number="2.2.3" class="anchored" data-anchor-id="groupes"><span class="header-section-number">2.2.3</span> Groupes</h3>
</section>
<section id="fusion-des-3-fichiers" class="level3" data-number="2.2.4">
<h3 data-number="2.2.4" class="anchored" data-anchor-id="fusion-des-3-fichiers"><span class="header-section-number">2.2.4</span> Fusion des 3 fichiers</h3>
<p>Convertir <code>hdrs_groupe</code>, <code>scl90_groupe</code> et <code>df_total_wide</code> de format “large” à format “long”</p>
<div style="page-break-after: always;"></div>
</section>
</section>
</section>
<section id="question-1-validation-de-léchelle-hamilton" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Question 1 : Validation de l’échelle Hamilton</h1>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Consigne de la question 1</strong> : Lorsque l’on utilise un instrument de mesure subjective dans une étude clinique, il est toujours bon de le (re)valider rapidement. Procédez ici à cette <strong>vérification</strong> sur l’échelle de dépression de Hamilton, aux temps J0 et J56.</p>
</div>
</div>
<ul>
<li><p>Vérification d’une échelle de mesure subjective = 1/ Que mesure l’instrument ? 2/ Que vaut la mesure ?</p></li>
<li><p>Premier temps : Évaluation préliminaire des réponses aux items, puis chercher une corrélation entre eux par une matrice de corrélation 2 à 2</p></li>
<li><p>Second temps : Analyse de la structure dimensionnelle = <strong>que mesure l’instrument ?</strong></p>
<ul>
<li><p>Exploration de la structure par analyse en composante principale : visualiser les relations entre les items</p></li>
<li><p>Détermination du nombre de dimensions : diagramme des valeurs propres (<em>scree plot</em>) permet de déterminer le nombre de dimensions (composantes principales)</p></li>
<li><p>Si structure dimensionnelle identifiée : <strong>analyse factorielle</strong> permet de déterminer quels items se regroupent dans chaque dimension</p></li>
</ul></li>
<li><p>Troisième temps : Évaluation de la fiabilité interne = <strong>que vaut la mesure ?</strong></p>
<ul>
<li><p>La consistance interne des items (évalue si les items sont cohérents entre eux) sera évaluée par le calcul de l’alpha de Cronbach</p></li>
<li><p>Échelle de Hamilton = hétéro-évaluation donc on peut aussi évaluer la concordance inter-juges (ici entre les items) par le coefficient de corrélation intraclasse (CCI)</p></li>
</ul></li>
<li><p>Quatrième temps : Évaluation de la validité = <strong>l’instrument mesure-t-il ce qu’il est censé mesurer ?</strong> (similaire à la question “que mesure l’instrument ?”)</p>
<ul>
<li><p>Validité interne : déjà évaluée au cours du second temps (structure dimensionnelle)</p></li>
<li><p>Validité externe : corrélation avec d’autres instruments de mesure (ici les dimensions de l’échelle SCL90)</p></li>
</ul></li>
</ul>
<section id="valdidation.à-j0" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="valdidation.à-j0"><span class="header-section-number">3.1</span> Valdidation.à J0</h2>
<section id="description" class="level3" data-number="3.1.1">
<h3 data-number="3.1.1" class="anchored" data-anchor-id="description"><span class="header-section-number">3.1.1</span> Description</h3>
<p>Les réponses sont représentées :</p>
<ul>
<li><p>par des histogrammes pour chaque item de l’échelle de Hamilton à J0</p></li>
<li><p>par une matrice de corrélation 2 à 2 entre les items</p></li>
</ul>
<p>NB : le code R utilise une fonction pour faciliter la création des histogrammes pour chaque item.</p>
<p>La fonction crée</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="devoir_stats_avancees_files/figure-html/histo%20items%20J0-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="devoir_stats_avancees_files/figure-html/histo%20items%20J0-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="devoir_stats_avancees_files/figure-html/matrice%20corrélation%20J0-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="validité-interne-structure-dimensionnelle-analyse-factorielle" class="level3" data-number="3.1.2">
<h3 data-number="3.1.2" class="anchored" data-anchor-id="validité-interne-structure-dimensionnelle-analyse-factorielle"><span class="header-section-number">3.1.2</span> Validité interne : structure dimensionnelle, analyse factorielle</h3>
</section>
<section id="validité-externe" class="level3" data-number="3.1.3">
<h3 data-number="3.1.3" class="anchored" data-anchor-id="validité-externe"><span class="header-section-number">3.1.3</span> Validité externe</h3>
</section>
</section>
<section id="validation-à-j56" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="validation-à-j56"><span class="header-section-number">3.2</span> Validation à J56</h2>
<section id="description-1" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="description-1"><span class="header-section-number">3.2.1</span> Description</h3>
</section>
<section id="validité-interne-structure-dimensionnelle-analyse-factorielle-1" class="level3" data-number="3.2.2">
<h3 data-number="3.2.2" class="anchored" data-anchor-id="validité-interne-structure-dimensionnelle-analyse-factorielle-1"><span class="header-section-number">3.2.2</span> Validité interne : structure dimensionnelle, analyse factorielle</h3>
</section>
<section id="validité-externe-1" class="level3" data-number="3.2.3">
<h3 data-number="3.2.3" class="anchored" data-anchor-id="validité-externe-1"><span class="header-section-number">3.2.3</span> Validité externe</h3>
</section>
</section>
</section>
<section id="question-2-comparaison-de-la-réponse-au-traitement-entre-deux-groupes-de-patients" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Question 2 : Comparaison de la réponse au traitement entre deux groupes de patients</h1>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>