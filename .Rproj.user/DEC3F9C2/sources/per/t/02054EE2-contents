---
title: "S3 C10 Comparaison de pourcentages"
output: html_document
date: "2025-09-26"
---

# S3 C10 Comparaison de pourcentages

# Comparer deux pourcentages (χ² et Fisher)

## Partie 1 — Le cours

### 1) Objectif

Comparer la proportion d’un événement entre deux groupes (tableau de contingence 2×2), puis tester l’hypothèse d’égalité des pourcentages :

-   H0 : les proportions sont égales (indépendance)

-   H1 : les proportions diffèrent

⸻

### 2) Données et binarisation

1.  On part d’une variable catégorielle ordinale ed (ex. éducation)
2.  que l’on binarise en ed.b (0/1)
3.  pour construire une table 2×2 avec dep.cons (ex. dépendance au tabac, 0/1).

```{r}
smp <- read.csv2("S1C2 smp1.csv")
str(smp$ed)
```

-   smp\$ed : catégorise le niveau d'évitement du danger

-   smp\$dep.cons : diagnostic de dépression

```{r}
smp$ed.b <- ifelse(smp$ed > 2, 1, 0) # seuil de binarisation
str(smp) # vérifier types et dimensions
table(smp$ed.b,smp$ed, deparse.level = 2)
```

En détails

-   `ifelse(cond, yes, no)` : renvoie 1 si ed \> 2, sinon 0

-   `str(smp)` : contrôle rapide des types (int, factor) et du nombre d’observations.

Exemple du cours : smp contient 799 observations et 10 variables, avec ed.b ajouté en fin de data.frame

⸻

### 3) Tableau de contingence et pourcentages

Créer la table croisée, puis pourcentages par ligne (structure au sein de chaque groupe de ed.b) et par colonne (structure au sein de chaque valeur de dep.cons). Donc pourcentages de déprimés parmi les évitements du danger Et pourcentages d'évitement du danger parmi les déprimés

```{r}
table(smp$ed.b, smp$dep.cons, deparse.level = 2, useNA = "always")
tab <- table(smp$ed.b, smp$dep.cons, deparse.level = 2)
```

```{r : calcul des %}
#1 : "fixe" la première valeur de tab
#2 : "fixe" la seconde valeur de tab
prop.table(tab, 1) # % par ligne : chaque ligne somme à 1
prop.table(tab, 2) # % par colonne : chaque colonne somme à 1
```

Interpréter :

-   `prop.table(tab, 1)` montre, à *ed.b* fixé, la répartition des issues (dep.cons = 0/1).\
    *donc à niveau d'évitement du danger fixé, la répartition des dépression*

-   `prop.table(tab, 2)` montre, à *dep.cons* fixé, la contribution des niveaux de *ed.b*.\
    *donc à niveau de dépression fixé, la répartition d'évitement du danger*

*Exemple du cours* :

-   chez **ed.b=0** *(donc les bas niveaux d'évitement*) : \~71% ont **dep.cons=0** et \~29% ont **dep.cons=1** (donc sont déprimés)

-   chez **ed.b=1**, *(donc les hauts niveaux d'évitement*) \~43% ont **dep.cons=0** et \~57% ont **dep.cons=1** (*donc sont déprimés*)

⸻

### 4) Test du χ² d’indépendance

Le test vérifie si l’écart observé des pourcentages dépasse ce qu’on attendrait par le seul hasard.

```{r}
chisq.test(smp$ed.b, smp$dep.cons, correct = FALSE)
#syntaxe : chisq.test(variable1, variable2)
```

-   **correct = FALSE** : désactive la correction de continuité de Yates (souvent désactivée en 2×2 pour cohérence avec d’autres mesures ; à discuter).\
    **correction de continuité : test plus robuste, mais nettement moins puissant**

-   Hypothèses : effectifs attendus pas trop petits ; sinon préférer Fisher.

    -   Si χ² pas réalisable : R affiche (**dans ce cas ⇒ préférer Test exact de Fischer)**\
        `Message d'avis : In chisq.test(x) : l'approximation du Chi-2 est peut-être incorrecte`

Exemple du cours :

-   χ² ≈ 50,44 (ddl = 1),

-   p ≈ 1,23×10⁻¹² → rejet de H0 (différence de pourcentages).

⸻

### 5) Test exact de Fisher (cas de petits effectifs)

Recommandé si des effectifs attendus faibles (ou des pourcentages très petits) rendent l’approximation χ² incertaine.

```{r}
fisher.test(smp$ed.b, smp$dep.cons)
```

-   Donne une p-value exacte, un odds ratio (OR) et un IC95%.

-   OR = (a·d) / (b·c)

-   OR = 1 : pas d’association ;

-   OR \> 1 : association positive ;

-   OR \< 1 : association inverse.

Exemple du cours :

-   p ≈ 2,03×10⁻¹² ;

-   OR ≈ 3,25 (IC95% ≈ [2,30 ; 4,60]).

Interprétation : l’odds de l’événement est \~3,25 fois plus élevée dans ed.b=1 que dans ed.b=0. ￼

Note : R peut émettre l'approximation du Chi-2 est peut-être incorrecte → privilégier Fisher. ￼

⸻

### 6) Bonnes pratiques & pièges

Avant de tester :

1.  regarder la table et les % (structures par ligne/colonne).

2.  Faibles effectifs → Fisher.

3.  Effet vs significativité : rapporter p-value, OR et IC95% (pas que p).

4.  Binarisation : justifier le seuil (ed\>2) et tester la robustesse (analyse de sensibilité).

5.  Types R : 0/1 numériques suffisent, mais transformer en factors rend les sorties plus explicites (factor(ed.b)).

⸻

## Partie 2 — Le rapport (rédaction structurée)

### Contexte

Nous souhaitons comparer 2 proportions (événement binaire **dep.cons**) selon une exposition binaire **ed.b.**\
La question est de savoir si les pourcentages diffèrent significativement entre les deux groupes.

### Méthodes

Nous avons binarisé **ed** en **ed.b = 1{ed\>2}**.

Nous avons décrit la table 2×2 et calculé des pourcentages par ligne et par colonne.

Deux tests ont été appliqués :

1.  χ² d’indépendance (sans correction de Yates), approprié si les effectifs attendus ne sont pas trop faibles

2.  Test exact de Fisher, recommandé lorsque l’approximation du χ² est douteuse (petits effectifs/rares événements).

Les résultats sont rapportés avec p-value, odds ratio et IC95%. ￼

### Résultats (exemple illustratif du cours)

La répartition des pourcentages suggère une différence entre ed.b=0 et ed.b=1.

Le test du χ² indique une association statistiquement significative (p ≈ 1,23×10⁻¹²).

Le test exact de Fisher confirme cette conclusion, avec OR ≈ 3,25 (IC95% ≈ [2,30 ; 4,60]), indiquant que l’odds de l’événement est substantiellement plus élevée dans le groupe ed.b=1. ￼

### Discussion

Les deux approches concordent et montrent une différence de proportions.

Le recours à Fisher est pertinent lorsque l’approximation du χ² est mise en doute par des effectifs faibles. Au-delà de la significativité, l’importance pratique (OR, IC95%) doit être rapportée.

La binarisation de ed doit être justifiée ; d’autres seuils pourraient être explorés en analyse de sensibilité.

### Conclusion

La comparaison de deux pourcentages repose sur une lecture conjointe du tableau 2×2, de tests adaptés (χ² ou Fisher) et d’une mesure d’effet (OR avec IC95%).

Dans l’exemple, l’association est statistiquement significative et d’ampleur notable. ￼

⸻

# Annexe — Script R minimal reproductible

### 1) Binarisation

```{r}
smp$ed.b <- ifelse(smp$ed > 2, 1, 0)
```

### 2) Table et % (diagnostic)

```{r}
tab_all <- table(smp$ed.b, smp$dep.cons, useNA = "ifany")
print(tab_all)
```

```{r}
tab <- table(smp$ed.b, smp$dep.cons)# on enlève les NA pour les tests 
prop.table(tab, 1) # % par ligne 
prop.table(tab, 2) # % par colonne
```

### 3) Tests

```{r}
chisq.test(smp$ed.b, smp$dep.cons, correct = FALSE)
fisher.test(smp$ed.b, smp$dep.cons)
```

# (Optionnel) Version table explicite

```{r}
chisq.test(tab, correct = FALSE)
```

```{r}
fisher.test(tab)
```

### Astuce lisibilité (optionnel)

```{r}
smp$ed.b      <- factor(smp$ed.b, levels = c(0,1), labels = c("≤2",">2")) 
smp$dep.cons  <- factor(smp$dep.cons, levels = c(0,1), labels = c("Non","Oui"))
```
